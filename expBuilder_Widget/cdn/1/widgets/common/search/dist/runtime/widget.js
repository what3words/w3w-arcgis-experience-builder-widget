System.register(["jimu-core","jimu-layouts/layout-runtime","jimu-ui","jimu-arcgis","jimu-theme"],(function(e,t){var o={},n={},r={},l={},i={};return{setters:[function(e){o.AppMode=e.AppMode,o.BaseVersionManager=e.BaseVersionManager,o.ClauseLogic=e.ClauseLogic,o.ClauseOperator=e.ClauseOperator,o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.JimuFieldType=e.JimuFieldType,o.MessageManager=e.MessageManager,o.React=e.React,o.ReactRedux=e.ReactRedux,o.RecordSetChangeType=e.RecordSetChangeType,o.UrlManager=e.UrlManager,o.UtilityManager=e.UtilityManager,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.i18n=e.i18n,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.moduleLoader=e.moduleLoader,o.polished=e.polished,o.urlUtils=e.urlUtils,o.utils=e.utils},function(e){n.PageVisibilityContext=e.PageVisibilityContext,n.ViewVisibilityContext=e.ViewVisibilityContext},function(e){r.Alert=e.Alert,r.Button=e.Button,r.Checkbox=e.Checkbox,r.Dropdown=e.Dropdown,r.DropdownButton=e.DropdownButton,r.DropdownItem=e.DropdownItem,r.DropdownMenu=e.DropdownMenu,r.Icon=e.Icon,r.Link=e.Link,r.Popper=e.Popper,r.TextInput=e.TextInput,r.defaultMessages=e.defaultMessages},function(e){l.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.useTheme=e.useTheme}],execute:function(){e((()=>{var e={21210:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A46 46 0 0 1 8 14.492a48 48 0 0 1-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133m1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.751C5.768 13.444 2 8.817 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133M10 5.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0m1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=l},79244:e=>{"use strict";e.exports=o},41496:e=>{"use strict";e.exports=n},1888:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=r}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var a={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(a),s.d(a,{__set_webpack_public_path__:()=>xt,default:()=>It});var e=s(79244),t=s(41496);const o=[0,3],n={wkid:4326};var r,l,i,u,c;!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(r||(r={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(l||(l={})),function(e){e.Style1="Style1",e.Style2="Style2",e.Style3="Style3"}(i||(i={})),function(e){e.Classic="Classic",e.Compact="Compact"}(u||(u={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(c||(c={}));var d=s(14321);const v={_widgetLabel:"Search",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistorie:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var g=s(30655),m=s.n(g),p=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const h=t=>{const o=window.SVG,{className:n}=t,r=p(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:l,src:m()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var f=s(94064),S=s.n(f),y=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const b=t=>{const o=window.SVG,{className:n}=t,r=y(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:l,src:S()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var I=s(62686);const x="address";var w=function(e,t,o,n){return new(o||(o=Promise))((function(r,l){function i(e){try{a(n.next(e))}catch(e){l(e)}}function s(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const j=e=>w(void 0,void 0,void 0,(function*(){const t=R(e),o={shouldConvertSR:!1,searchText:e};if(!t)return Promise.resolve(o);const n=yield N(e),r=yield function(e){return w(this,void 0,void 0,(function*(){return(0,I.loadArcGISJSAPIModules)(["esri/geometry/coordinateFormatter","esri/geometry/SpatialReference"]).then((t=>{const[o,n]=t;if(o.load(),o.isSupported()){if(o.isLoaded()){const t=o.fromUtm(e,new n({wkid:4326}),"latitude-band-indicators");return t&&(null==t?void 0:t.x)&&(null==t?void 0:t.y)?Promise.resolve(!0):Promise.resolve(!1)}return Promise.resolve(!1)}return Promise.resolve(!0)}))}))}(e);return n?function(e){return w(this,void 0,void 0,(function*(){let t=e;return(0,I.loadArcGISJSAPIModules)(["esri/geometry/SpatialReference","esri/rest/support/ProjectParameters","esri/geometry/support/webMercatorUtils","esri/rest/geometryService"]).then((o=>{const[n,r,l,i]=o,s=new n({wkid:4326});if(s&&e){if(s.equals(e.spatialReference))return Promise.resolve(t);if(s.isWebMercator&&e.spatialReference.equals(s))return t=l.geographicToWebMercator(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);if(s.equals(s)&&e.spatialReference.isWebMercator)return t=l.webMercatorToGeographic(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);{const o=M();if(o){const n=new r;return n.geometries=[e],n.outSpatialReference=s,n.f="json",i.project(o,n).then((o=>(t=o&&o.length>0&&o[0],t?(t.isSinglePoint=e.isSinglePoint,Promise.resolve(t)):Promise.resolve(t))),(e=>Promise.reject(e)))}return Promise.resolve(t)}}return Promise.resolve(null)}))}))}(n).then((t=>{const o=C(t);return Promise.resolve({shouldConvertSR:!!o,searchText:o||e,locationPoint:t})}),(e=>Promise.resolve(o))):r?function(e){return w(this,void 0,void 0,(function*(){const t=M();return(0,I.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/request"]).then((o=>{const[n,r,l]=o;let i=null;const s={query:{sr:4326,conversionType:"UTM",conversionMode:"utmDefault",strings:[e],f:"json"},responseType:"json"};if(!t)return Promise.resolve(i);l(`${t}/fromGeoCoordinateString`,s).then((e=>{const t=Number(e[0][0]),o=Number(e[0][1]);return isNaN(t)||isNaN(o)||(i=new n(t,o,new r({wkid:4326}))),Promise.resolve(i)}))}))}))}(e).then((t=>{const o=C(t);return Promise.resolve({shouldConvertSR:!!o,searchText:o||e,locationPoint:t})})):Promise.resolve(o)}));function R(e){return e&&P(e)}const N=t=>w(void 0,void 0,void 0,(function*(){return(0,I.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((o=>{const[n,r]=o;return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{const{isValidWkid:o}=e;let l=null;if(!t)return l;const i=t.split(":"),s=i[0],a=Number(i[1]);if(a&&o(a)&&s){const e=s.split(","),t=Number(e[0]),o=Number(e[1]);isNaN(t)||isNaN(o)||(l=new n(t,o,new r({wkid:a})))}return Promise.resolve(l)}))}))}));function C(e){let t=null;return!e||isNaN(e.x)||isNaN(e.y)||(t="Y:"+e.y+",X:"+e.x),t}function M(){var t,o;const n=(0,e.getAppStore)().getState();return(null===(o=((null===(t=null==n?void 0:n.portalSelf)||void 0===t?void 0:t.helperServices)||{}).geometry)||void 0===o?void 0:o.url)||null}const P=e=>null==e?void 0:e.includes(",");var k=function(e,t,o,n){return new(o||(o=Promise))((function(r,l){function i(e){try{a(n.next(e))}catch(e){l(e)}}function s(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const T={alias:"ADDRESS",type:"string",name:x},D=(Object.assign(Object.assign({},T),{jimuName:x}),(e,t)=>ie(null==t?void 0:t.outputDataSourceId)&&(null==t?void 0:t.isSupportSuggest)?O(t,e):Promise.resolve({})),O=(e,t)=>{var o;return A(null==e?void 0:e.geocodeURL,t,null==e?void 0:e.maxSuggestions,null===(o=null==e?void 0:e.useUtility)||void 0===o?void 0:o.utilityId).then((o=>{if(!Array.isArray(o))return Promise.resolve({suggestionItem:[],layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon,err:o});let n=[];o.forEach(((o,r)=>{const l=o.text;if(l&&!function(e,t){return e.filter((e=>t===(null==e?void 0:e.suggestion))).length>0}(n,l)){const r={suggestionHtml:ne(l,t),suggestion:l,configId:null==e?void 0:e.configId,magicKey:null==o?void 0:o.magicKey};n.push(r)}})),n=Y(n,"suggestion");const r={suggestionItem:n.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(r)})).catch((e=>Promise.reject(e)))},F=(t,o,n,r)=>{if(!ie(null==n?void 0:n.outputDataSourceId))return;return le(X(n.outputDataSourceId),e.DataSourceStatus.NotReady),L({address:t,maxResultNumber:o,searchResultView:r,geocodeItem:n})},L=t=>{const{address:o,maxResultNumber:n,geocodeItem:r}=t,{outputDataSourceId:l,singleLineFieldName:i,defaultAddressFieldName:s}=r,a=X(l),u={geocodeItem:r,address:o,maxResultNumber:n,singleLineFieldName:i,addressFields:(null==r?void 0:r.addressFields)||[]};return E(u).then((t=>k(void 0,void 0,void 0,(function*(){if(!Array.isArray(t))return Promise.resolve(!1);const n=null==t?void 0:t.filter((e=>null==e?void 0:e.address));let r;const i=(null==n?void 0:n.map(((e,t)=>{const o=e.attributes;o.address=e.address,s&&(o[s]=e.address),o.objectid=t,r=e.extent;return{attributes:o,geometry:e.location}})))||[],u=a;yield u.setSourceFeatures(i,{id:`${l}_layer`,geometryType:"point",fullExtent:r});const c=o?e.DataSourceStatus.Unloaded:e.DataSourceStatus.NotReady;return le(a,c),Promise.resolve(e.DataSourceStatus.Unloaded)})))).catch((e=>Promise.reject(e)))},E=t=>k(void 0,void 0,void 0,(function*(){const{geocodeItem:o,address:r,maxResultNumber:l,singleLineFieldName:i,addressFields:s}=t,{geocodeURL:a,magicKey:u,useUtility:c}=o,d=(null==o?void 0:o.spatialReference)||n,v=R(r);let g;return v&&(g=yield j(r)),(0,I.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then((t=>{var o;const[n,m]=t,p=new m(d),h=i||"SingleLine";let f=(0,e.Immutable)({maxSuggestions:l});const S=null===(o=null==s?void 0:s.map((e=>null==e?void 0:e.jimuName)))||void 0===o?void 0:o.join(",");S&&(f=f.set("outFields",S));const y=v&&g.searchText?g.searchText:r;f=f.setIn([h],y),u&&(f=f.set("magicKey",u));const b={address:null==f?void 0:f.asMutable({deep:!0}),outSpatialReference:p};return v&&g.locationPoint&&(b.location=g.locationPoint),n.addressToLocations(a,b,{query:{}}).then((e=>(e=(e=e.sort(((e,t)=>t.score-e.score))).filter((e=>!!(null==e?void 0:e.location))),U(null==c?void 0:c.utilityId),e)),(e=>{console.error(e.message);const t=G(null==c?void 0:c.utilityId,e);return $(null==c?void 0:c.utilityId,e),t?e:[]}))}))})),A=(e,t,o,n)=>(0,I.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((r=>{const[l]=r;return l.suggestLocations(e,{text:t,maxSuggestions:o}).then((e=>(U(n),e||[])),(e=>{console.error(e.message);const t=G(n,e);return $(n,e),t?e:[]}))}));function U(t){e.UtilityManager.getInstance().reportUtilityState(t,!0)}function $(t,o){const n=G(t,o),r=e.UtilityManager.getInstance().utilityHasSignInError(t);n?e.UtilityManager.getInstance().reportUtilityState(t,!1,r):e.UtilityManager.getInstance().reportUtilityState(t,!1)}function G(t,o){var n,r,l,i;const s=e.UtilityManager.getInstance().utilityHasSignInError(t);let a=404===(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.httpStatus);return 400===(null===(r=null==o?void 0:o.details)||void 0===r?void 0:r.httpStatus)&&(null===(i=null===(l=null==o?void 0:o.details)||void 0===l?void 0:l.message)||void 0===i?void 0:i.includes("Item does not exist"))&&(a=!0),s||a}const B=(e,t,o,n=!1)=>{const r=null==e?void 0:e.outputDataSourceId,l=X(null==e?void 0:e.outputDataSourceId),i=null==l?void 0:l.getRecordsByPage(1,t);return Promise.resolve({records:i,configId:e.configId,dsId:r,isGeocodeRecords:!0,displayFields:null==e?void 0:e.displayFields})},_=(e,t=n)=>{const o=e&&e.coords;return o?(0,I.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{const[n,r]=e,l=new r(t);return new n({longitude:o.longitude,latitude:o.latitude,z:o.altitude||null,spatialReference:l})})):Promise.resolve(null)};var V=function(e,t,o,n){return new(o||(o=Promise))((function(r,l){function i(e){try{a(n.next(e))}catch(e){l(e)}}function s(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};function q(t,o,n){return V(this,void 0,void 0,(function*(){var r,l;const i=(null==o?void 0:o.datasourceConfig)||[];if(!ie(null===(r=null==n?void 0:n.useDataSource)||void 0===r?void 0:r.dataSourceId))return Promise.resolve({});const s=(null==n?void 0:n.searchFields)||[],a=null===(l=null==i?void 0:i.filter((e=>(null==e?void 0:e.configId)===n.configId)))||void 0===l?void 0:l[0];return function(t,o,n,r,l){return V(this,void 0,void 0,(function*(){var i;const{label:s,icon:a,configId:u}=n,c=null===(i=null==o?void 0:o.useDataSource)||void 0===i?void 0:i.dataSourceId,d=X(c),v={searchText:t,searchFields:r.map((e=>e.name)),dataSource:d,maxSuggestions:l};return e.dataSourceUtils.querySuggestions(v).then((e=>{const t={suggestionItem:null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{configId:u,isFromSuggestion:!0}))),layer:s,icon:a};return Promise.resolve(t)})).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,n,a,s,null==o?void 0:o.maxSuggestions)}))}function J(t,o,n,r){if(o){const l=[];return o.forEach((o=>{let i=t;const s=null==n?void 0:n.getFieldCodedValueList(null==o?void 0:o.name);if(s&&(null==s||s.forEach((e=>{i===(null==e?void 0:e.label)&&(i=null==e?void 0:e.value)}))),o.type===e.JimuFieldType.Number){const t=e.dataSourceUtils.convertStringToNumber(i);t&&(i=t)}const a=(null==t?void 0:t.length)>0&&!isNaN(Number(i))&&isFinite(Number(i));if(o.type===e.JimuFieldType.Number&&!a)return!1;const u=function(t,o){let n;t===e.JimuFieldType.Number?n=e.ClauseOperator.NumberOperatorIs:t===e.JimuFieldType.String&&(n=o?e.ClauseOperator.StringOperatorIs:e.ClauseOperator.StringOperatorContains);return n}(o.type,r),c=o.type===e.JimuFieldType.Number?Number(i):i,d=e.dataSourceUtils.createSQLClause(null==o?void 0:o.name,u,[{value:c,label:c+""}]);l.push(d)})),e.dataSourceUtils.createSQLExpression(e.ClauseLogic.Or,l,n)}}function z(e,t,o){const n=(null==e?void 0:e.map((e=>e.jimuName)))||[],r=(null==t?void 0:t.map((e=>e.jimuName)))||[],l=X(o),i=(null==l?void 0:l.getAllUsedFields())||[];return"*"===i?"*":Array.from(new Set(n.concat(r).concat(i)))}const W=(t,o,n)=>{var r;const l=null===(r=null==t?void 0:t.useDataSource)||void 0===r?void 0:r.dataSourceId,i=ae(t.configId,n);if(!ie(l,i))return Promise.resolve({});const s=X(l,i),a=e.DataSourceManager.getInstance().getLocalDataSourceId(l,i),u=null==s?void 0:s.getRecordsByPage(1,o);return Promise.resolve({records:u,configId:t.configId,dsId:l,localDsId:a,isGeocodeRecords:!1})};function H(t){var o,n;const{serviceList:l,searchText:i,id:s}=t,a={};for(const e in l){const t=l[e],{searchServiceType:i,useDataSource:s}=t;if(i===r.FeatureService&&(null==s?void 0:s.dataSourceId)){const e=null==s?void 0:s.dataSourceId;let r=(null===(o=null==a?void 0:a[e])||void 0===o?void 0:o.sqlExpression)||null,l=(null===(n=a[e])||void 0===n?void 0:n.outFields)||[];const i=z(t.searchFields,t.displayFields,e)||[];a[e]?((null==t?void 0:t.SQL)&&r.push(null==t?void 0:t.SQL),l=Array.from(new Set(l.concat(i)))):(r=(null==t?void 0:t.SQL)?[null==t?void 0:t.SQL]:null,l=i,a[e]={}),a[e].sqlExpression=r,a[e].outFields=l}}!function(t,o,n){var r,l;for(const i in null==t?void 0:t.asMutable({deep:!0})){const s=null===(r=null==t?void 0:t[i])||void 0===r?void 0:r.sqlExpression,a=null===(l=null==t?void 0:t[i])||void 0===l?void 0:l.outFields,u=X(i);let c,d;n?s?(d=e.dataSourceUtils.getMergedSQLExpressions(null==s?void 0:s.asMutable({deep:!0}),u,e.ClauseLogic.Or),c=d.sql):(c="1=0",d=null):(c="1=1",d=null);const v=(0,e.Immutable)({outFields:a,where:c,sqlExpression:d,returnGeometry:!0});u&&u.updateQueryParams(v,o)}}((0,e.Immutable)(a),s,i)}const K=(e,t,o,n)=>{var r;const l=null===(r=null==e?void 0:e.useDataSource)||void 0===r?void 0:r.dataSourceId,i=ae(o,t),s=X(l),a=X(l,i);a&&a.updateQueryParams({},i),n&&s&&s.updateQueryParams({},t)},Q=(e,t,o,n=!1)=>{const l=[];for(const i in e){const s=e[i];let a;a=s.searchServiceType===r.FeatureService?W(s,t,o):B(s,t,0,n),l.push(a)}return Promise.all(l)},X=(t,o)=>{if(!t)return null;if(o){const n=e.DataSourceManager.getInstance(),r=n.getLocalDataSourceId(t,o);return n.getDataSource(r)}return e.DataSourceManager.getInstance().getDataSource(t)},Y=(e,t)=>{const o=e[0]?[e[0]]:[];for(let n=1;n<e.length;n++){const r=e[n];let l=!1;for(let e=0;e<o.length;e++)if(r[t]===o[e][t]){l=!0;break}l||o.push(r)}return o},Z=t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=ee(o,t);let r=e.utils.readLocalStorage(n);r&&(r=unescape(r));return r?null==r?void 0:r.split("/@/"):[]},ee=(e,t)=>`exb-${e}-${t}_recent_searches`,te=(e,t)=>{var o,n,r;return null===(r=null===(n=null===(o=null==e?void 0:e.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.filter((e=>e.configId===t)))||void 0===r?void 0:r[0]},oe=e=>{let t=0;for(const o in e)t++;return t};function ne(e,t){if(!t)return e;const o=new RegExp(`(${re(t)})`,"gi"),n=new RegExp(`(${re(t)})`,"gi");return e.match(o)?e.replace(n,"<strong >$1</strong>"):e}function re(e){return e.replace(/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g,"\\$&")}function le(e,t){e.setStatus(t),e.setCountStatus(t)}function ie(e,t){return!!e&&!!X(e,t)}const se=(t,o,n=e.RecordSetChangeType.CreateUpdate)=>{const r=[];null==o||o.forEach((e=>{var t;if(null==e?void 0:e.isGeocodeRecords){const o=X(e.dsId),n=null===(t=null==e?void 0:e.displayFields)||void 0===t?void 0:t.map((e=>e.jimuName)),l={records:e.records,fields:n,dataSource:o,name:o.id};r.push(l)}}));const l=new e.DataRecordSetChangeMessage(t,n,r);e.MessageManager.getInstance().publishMessage(l)},ae=(e,t)=>`${t}_${e}_useDataSource`,ue=(t,o)=>{var n;let l=!0;for(const i in t){const s=t[i];let a;if(s.searchServiceType===r.FeatureService){const e=null===(n=null==s?void 0:s.useDataSource)||void 0===n?void 0:n.dataSourceId,t=ae(s.configId,o);a=X(e,t)}else{const e=null==s?void 0:s.outputDataSourceId;a=X(e)}(null==a?void 0:a.getStatus())===e.DataSourceStatus.Loading&&(l=!1)}return l},ce=t=>{var o,n;if(!t)return;const r=(0,e.getAppStore)().getState();return JSON.parse((null===(n=null===(o=null==r?void 0:r.urlHashObject)||void 0===o?void 0:o[t])||void 0===n?void 0:n.search_status)||"{}")},de=(t,o)=>{if(!t)return;const n=o?JSON.stringify(o):null;e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:n})},{useRef:ve,useState:ge,useEffect:me}=e.React,pe=e.css`
& {
  box-sizing: border-box;
  width: ${e.polished.rem(32)};
}
.setting-dropdown-button {
  height: ${e.polished.rem(32)};
  border-radius: 0;
  svg {
    margin: 0 !important;
  }
}
&.ds-setting-Style1 {
  .setting-dropdown-button {
    border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
  }
}
&.ds-setting-Style2 {
  & {
    margin-right: ${e.polished.rem(4)};
  }
  .setting-dropdown-button {
    border-radius: 50%;
  }
}
&.ds-setting-Style3 {
  .setting-dropdown-button {
    background: none;
    border: none;
  }
}
`,he=t=>{const o=e.hooks.useTranslation(v,d.defaultMessages),[n,l]=ge(!0),[i,s]=ge(!1),[a,u]=e.React.useState(!1),{className:c,datasourceConfig:g,dsStatus:m,config:p,id:f,useDataSources:S,onDatasourceConfigChange:y}=t,I=ve(null),x=ve(null),w=t=>{const o=[];null==t||t.forEach((e=>{e.enable&&o.push(e.configId)})),((t,o,n)=>{if(!o||!t)return;const r=ce(t)||{};r[o]=n,e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:JSON.stringify(r)})})(f,"serviceEnabledList",o)},j=(e,t)=>{if(!e)return!1;const o=null==e?void 0:e.getAttribute("z-index"),n=null==e?void 0:e.role,r=e&&e.tagName||"",l="button"===r.toLowerCase()||"button"===n,i="input"===r.toLowerCase()||"input"===n,s="a"===r.toLowerCase()||"linkClick"===t.exbEventType;return l||s||!!o&&o>-1||i};me((()=>{const e=null==g?void 0:g.filter((e=>!(null==e?void 0:e.enable))),t=0===(null==e?void 0:e.length),o=(null==e?void 0:e.length)>0&&(null==e?void 0:e.length)<(null==g?void 0:g.length);s(o),l(t)}),[g]);return(0,e.jsx)("div",{className:`${c||""} ds-setting-${p.arrangementStyle}`,css:pe,role:"group","aria-label":o("searchIn",{value:""})},(0,e.jsx)(d.Dropdown,{className:"w-100 h-100",toggle:e=>{var t;const o=null==e?void 0:e.target;if(null===(t=null==I?void 0:I.current)||void 0===t?void 0:t.contains(o))return!1;j(o,e)&&a&&(clearTimeout(x.current),x.current=setTimeout((()=>{null==o||o.focus()}),200)),u(!a)},isOpen:a},(0,e.jsx)(d.DropdownButton,{className:"setting-dropdown-button",arrow:!1,icon:!0,title:o("searchIn",{value:""})},!a&&(0,e.jsx)(h,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),a&&(0,e.jsx)(b,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})),(0,e.jsx)(d.DropdownMenu,{trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"}},(0,e.jsx)("div",{ref:I},(0,e.jsx)(d.DropdownItem,{onClick:()=>{const e=!n,t=null==g?void 0:g.map((t=>{var o;return null===(o=t.setIn(["enable"],e))||void 0===o?void 0:o.asMutable({deep:!0})}));w(t),y(t)},title:o("all")},(0,e.jsx)(d.Checkbox,{checked:n||i,indeterminate:i,className:"mr-2"}),o("all")),(0,e.jsx)(d.DropdownItem,{divider:!0}),null==g?void 0:g.map(((t,n)=>{var l;const i=m[t.configId]===e.DataSourceStatus.LoadError||m[t.configId]===e.DataSourceStatus.CreateError,s=t.searchServiceType===r.GeocodeService,a=((t,o=!1)=>{var n;let r;if(o){const o=(0,e.getAppStore)().getState().appConfig,l=null===(n=null==o?void 0:o.widgets)||void 0===n?void 0:n[f],i=(null==l?void 0:l.outputDataSources)||[];r=(null==i?void 0:i.filter((e=>t===e)).length)>0}else r=(null==S?void 0:S.filter((e=>t===e.dataSourceId)).length)>0;return r&&t})(s?t.outputDataSourceId:t.useDataSource.dataSourceId,s),u=1===(null===(l=null==g?void 0:g.filter((e=>null==e?void 0:e.enable)))||void 0===l?void 0:l.length)&&(null==t?void 0:t.enable)&&i;return(0,e.jsx)(d.DropdownItem,{key:`${null==t?void 0:t.label}${n}`,title:null==t?void 0:t.label,disabled:u,onClick:()=>{((e,t)=>{const o=null==g?void 0:g.setIn([t,"enable"],e);w(o),y(o)})(!(null==t?void 0:t.enable),n)}},(0,e.jsx)("div",{className:"d-flex w-100 h-100 align-items-center"},(0,e.jsx)("div",{className:"flex-grow-1 d-flex align-items-center"},(0,e.jsx)(d.Checkbox,{checked:null==t?void 0:t.enable,disabled:u,className:"mr-2"}),(0,e.jsx)("div",{className:"flex-grow-1"},null==t?void 0:t.label)),(i||!a)&&(0,e.jsx)(d.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:o("dataSourceCreateError")})))}))))))};var fe=s(1888);const Se=(t,o)=>{var n,r,l,i,s,a,u,c,d,v,g,m,p,h,f;return e.css`
    & {
      width: ${e.polished.rem(null===(n=null==o?void 0:o.current)||void 0===n?void 0:n.clientWidth)};
      padding-top: 0;
      padding-bottom: 0;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${e.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--ref-palette-neutral-200);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(l=null===(r=null==t?void 0:t.sys.color)||void 0===r?void 0:r.secondary)||void 0===l?void 0:l.dark};
      background-color: ${null===(s=null===(i=null==t?void 0:t.ref.palette)||void 0===i?void 0:i.neutral)||void 0===s?void 0:s[300]};
    }
    &.result-list-con button:hover {
      color: ${null===(a=null==t?void 0:t.ref.palette)||void 0===a?void 0:a.black};
      background-color: ${null===(c=null===(u=null==t?void 0:t.ref.palette)||void 0===u?void 0:u.neutral)||void 0===c?void 0:c[200]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(d=null==t?void 0:t.ref.palette)||void 0===d?void 0:d.black};
      background-color: ${null===(g=null===(v=null==t?void 0:t.ref.palette)||void 0===v?void 0:v.neutral)||void 0===g?void 0:g[200]};
    }
    &.result-list-con .dropdown-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(m=null==t?void 0:t.sys.color)||void 0===m?void 0:m.primary.main};
      color: ${null===(p=null==t?void 0:t.ref.palette)||void 0===p?void 0:p.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(h=null==t?void 0:t.ref.palette)||void 0===h?void 0:h.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(f=null==t?void 0:t.ref.palette)||void 0===f?void 0:f.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${e.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--sys-color-primary-main) !important;
      height: ${e.polished.rem(40)};
      margin-top: ${e.polished.rem(-4)};
    }
    .dropdown-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${e.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--ref-palette-black) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${e.polished.rem(11)};
        min-height: ${e.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${e.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${e.polished.rem(8)};
          min-height: ${e.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${e.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--ref-palette-white);
      }
    }
  `},{useEffect:ye,useRef:be}=e.React,Ie=t=>{const n=be(null),r=be(null),{children:l,isOpen:i,reference:s,searchInputRef:a,autoFocus:u,className:c,isFocusWidtSearchInput:v,id:g,offset:m,version:p,toggle:h}=t,f=(0,fe.useTheme)(),S=e.ReactRedux.useSelector((e=>{var t;const o=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==o?void 0:o[g])||void 0===t?void 0:t.state}));ye((()=>{var e;return(null==a?void 0:a.current)&&v&&(null===(e=a.current)||void 0===e||e.addEventListener("keydown",y,!0)),()=>{var e;v&&(null===(e=a.current)||void 0===e||e.removeEventListener("keydown",y,!0))}}),[]);const y=e.hooks.useEventCallback((e=>{if(!i)return!1;const t=x()||[],o=(null==t?void 0:t.length)-1;"ArrowUp"===e.key?r.current=setTimeout((()=>{t[o].focus()})):"ArrowDown"===e.key&&(r.current=setTimeout((()=>{t[0].focus()})))})),b=e.hooks.useEventCallback((e=>{if(!i)return;const t="button"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),i&&t))if(clearTimeout(r.current),"Escape"===e.key)I(e);else if(["ArrowUp","ArrowDown"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const t=x();let o=t.indexOf(e.target),l=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey?(o=0!==o?o-1:t.length-1,l=!0):("ArrowDown"===e.key||"n"===e.key&&e.ctrlKey)&&(l=!1,o=o===t.length-1?0:o+1);const i=0===o&&!l,s=o===t.length-1&&l;r.current=v&&(i||s)?setTimeout((()=>{var e;null===(e=a.current)||void 0===e||e.focus()})):setTimeout((()=>{Array.prototype.slice.call(n.current.querySelectorAll(".popper-box"))[0].focus(),t[o].focus()}))}else if("End"===e.key){const e=x();r.current=setTimeout((()=>{e[e.length-1].focus()}))}else if("Home"===e.key){const e=x();r.current=setTimeout((()=>{e[0].focus()}))}else if(e.which>=48&&e.which<=90){const t=x(),o=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<t.length;e+=1){if((t[e].textContent&&t[e].textContent[0].toLowerCase())===o){r.current=setTimeout((()=>{t[e].focus()}));break}}}})),I=e=>{var t;e.preventDefault(),w(e),null===(t=null==a?void 0:a.current)||void 0===t||t.focus()},x=()=>n?Array.prototype.slice.call(n.current.querySelectorAll('[role="button"]')).filter((e=>!e.disabled)):[],w=e=>{h(e)};return(0,e.jsx)("div",null,(0,e.jsx)(d.Popper,{autoFocus:u,placement:"bottom-start",open:i,toggle:w,css:Se(f,s),reference:s,version:p,className:(0,e.classNames)("result-list-popper",c,{"hide-popper":S===e.WidgetState.Closed}),offset:m||o,popperNodeRef:n},(0,e.jsx)("div",{onKeyDown:b},l)))},{useState:xe,useRef:we,useEffect:je}=e.React,Re=e.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,Ne=t=>{const o=e.hooks.useTranslation(d.defaultMessages,e.defaultMessages),n=we(null),{serviceList:l,open:i,toggleUtilityErrorRemind:s}=t,[a,u]=xe(null),c=e.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates}));je((()=>{i&&(clearTimeout(n.current),n.current=setTimeout((()=>{s(!1)}),5e3))}),[i]),je((()=>{v(c)}),[c]);const v=e=>{var t;if(!l)return;let o=null,n=[],i=[];if(null===(t=Object.keys(l))||void 0===t||t.forEach((t=>{var o;const s=l[t];if(s.searchServiceType===r.GeocodeService){const t=null===(o=null==s?void 0:s.useUtility)||void 0===o?void 0:o.utilityId;if(t){const o=null==e?void 0:e[t];(null==o?void 0:o.isSignInError)?i.push(t):!1===(null==o?void 0:o.success)&&n.push(t)}}})),n=g(n),i=g(i),0===(null==n?void 0:n.length)&&(null==i?void 0:i.length)>0)o=m(i);else if(0===(null==i?void 0:i.length)&&(null==n?void 0:n.length)>0)o=p(n);else if((null==i?void 0:i.length)>0&&(null==n?void 0:n.length)>0){o=`${m(i)} ${p(n)}`}u(o)},g=(t=[])=>(t=Array.from(new Set(t))).map((t=>{const o=e.UtilityManager.getInstance().getUtilityJson(t);return null==o?void 0:o.label})),m=e=>{let t=null;return 1===oe(l)?(null==e?void 0:e.length)>0&&(t=o("signInErrorDefault")):(null==e?void 0:e.length)>0&&(t=o("signInErrorsDefault",{names:e.join(", ")})),t},p=e=>{let t=null;return 1===oe(l)?1===(null==e?void 0:e.length)&&(t=o("utilityInaccessible")):(null==e?void 0:e.length)>0&&(t=o("utilityNotAvailableWidthName",{name:e.join(", ")})),t};return(0,e.jsx)("div",{className:"posotion-relative w-100",css:Re},(0,e.jsx)("div",{className:"w-100 utility-err-remind-con"},(0,e.jsx)(d.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{s(!1)},text:a,title:a})))},{useRef:Ce}=e.React,Me=new(0,e.esri.Sanitizer),Pe=t=>{const{className:o,reference:n,searchSuggestion:r,isOpen:l,canUseOutoutDsLength:i,id:s,searchInputRef:a,openUtilityErrRemindInSuggestion:u,serviceList:c,searchText:v,toggleSuggestionUtilityError:g,toggel:m,onRecordItemClick:p,setSuggestionFirstItem:h}=t,f=(0,fe.useTheme)(),S=Ce(!1),y=()=>{if((null==r?void 0:r.length)<2)return!1;let e=0,t=0;return null==r||r.forEach((o=>{var n;const r=null==o?void 0:o.icon;r&&(e+=1),(null===(n=o.suggestionItem)||void 0===n?void 0:n.length)>0&&r&&(t+=1)})),t>0&&e>0},b=(t,o=!1)=>{const n=null==t?void 0:t.suggestionItem,r=null==t?void 0:t.icon;return null==n?void 0:n.map(((n,l)=>{var s;const a=Me.sanitize(n.suggestionHtml),u={configId:null==n?void 0:n.configId,isFromSuggestion:null==n?void 0:n.isFromSuggestion,magicKey:null==n?void 0:n.magicKey};return(0,e.jsx)(d.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":o}),key:`${null==t?void 0:t.layer}${l}`,title:n.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:r}=t||{};o&&(n||r)?p(e,t):p(e)})(n.suggestion,u)},ref:e=>{I(l,e)}},r&&1===i&&(0,e.jsx)(d.Icon,{className:"mr-2",color:null===(s=null==f?void 0:f.sys.color)||void 0===s?void 0:s.primary.main,size:16,icon:null==r?void 0:r.svg}),(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:a}}))}))},I=(e,t)=>{0!==e||S.current||(h(t),S.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(Ie,{isOpen:l&&!(()=>{let e=[];return r.forEach((t=>{const o=(null==t?void 0:t.suggestionItem)||[];e=e.concat(o)})),v&&0===e.length})()||u,autoFocus:!1,reference:n,searchInputRef:a,isFocusWidtSearchInput:!0,toggle:m,id:s,className:(0,e.classNames)("result-list-con suggestion-list-con",o)},!u&&(S.current=null,null==r?void 0:r.map(((t,o)=>{var n,l,i;const s=(null==r?void 0:r.length)>1&&(null===(n=null==t?void 0:t.suggestionItem)||void 0===n?void 0:n.length)>0;return(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"group","aria-label":null==t?void 0:t.layer},s&&(0,e.jsx)(d.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==t?void 0:t.layer},(null==t?void 0:t.icon)&&(0,e.jsx)(d.Icon,{className:"mr-2",color:null===(l=null==f?void 0:f.sys.color)||void 0===l?void 0:l.primary.main,size:16,icon:null===(i=null==t?void 0:t.icon)||void 0===i?void 0:i.svg}),null==t?void 0:t.layer),b(t,y()))}))),u&&(0,e.jsx)(Ne,{open:u,serviceList:c,toggleUtilityErrorRemind:g})))};var ke=s(9044),Te=s.n(ke),De=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const Oe=t=>{const o=window.SVG,{className:n}=t,r=De(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:l,src:Te()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var Fe=s(21210),Le=s.n(Fe),Ee=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const Ae=t=>{const o=window.SVG,{className:n}=t,r=Ee(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:l,src:Le()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var Ue=s(28996),$e=s.n(Ue),Ge=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const Be=t=>{const o=window.SVG,{className:n}=t,r=Ge(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:l,src:$e()},r)):e.React.createElement("svg",Object.assign({className:l},r))},_e=t=>{const o=e.hooks.useTranslation(v,d.defaultMessages),{serviceList:l,locationLoading:i,isGetLocationError:s,onLocationChange:a,handleLocationLoadingChange:u}=t,[c,g]=e.React.useState(null);e.React.useEffect((()=>{m()}),[l]);const m=()=>{var e;for(const t in l){const o=null===(e=l[t])||void 0===e?void 0:e.asMutable({deep:!0});if(o.searchServiceType===r.GeocodeService){g(o);break}}},p=e=>{u(!1);const t=`${e.coords.longitude},${e.coords.latitude}`;if(c){((e,t,o=n)=>t?(0,I.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then((n=>{const[r,l]=n;return _(t,o).then((t=>{const n=new l(o);return r.locationToAddress(e,{location:t,outSpatialReference:n},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>(console.error(e.message),Promise.reject(e.message))))}))})):Promise.resolve(null))(null==c?void 0:c.geocodeURL,e,null==c?void 0:c.spatialReference).then((e=>{a(e)}),(e=>{a(t)}))}else a(t)},h=e=>{u(!1),a(null,null,!0)};return(0,e.jsx)("div",null,!s&&(0,e.jsx)(d.Button,{role:"button",onClick:()=>{if(i)return!1;u(!0),((e,t)=>{if(navigator.geolocation){const o={enableHighAccuracy:!0,timeout:3e3,maximumAge:1e4};navigator.geolocation.getCurrentPosition(e,t,o)}else t&&t()})(p,h)},title:o("useCurrentLocation")},(0,e.jsx)(Ae,{className:"mr-2"}),o("useCurrentLocation")),s&&(0,e.jsx)(d.Button,{role:"button",title:o("couldNotRetrieve")},(0,e.jsx)(Be,{className:"mr-2"}),o("couldNotRetrieve")))},{useRef:Ve}=e.React,qe=new(0,e.esri.Sanitizer),Je=t=>{var o,n,r,l;const i=e.hooks.useTranslation(v,d.defaultMessages),{className:s,reference:a,recentSearchesData:u,isOpen:c,isGetLocationError:g,serviceList:m,config:p,id:h,searchInputRef:f,locationLoading:S,toggel:y,onRecordItemClick:b,clearSearches:I,setSuggestionFirstItem:x,handleLocationLoadingChange:w}=t,j=Ve(!1),R=t=>{const o=null==t?void 0:t.suggestionItem;return null==o?void 0:o.map(((o,n)=>{const r=qe.sanitize(o.suggestionHtml),l={configId:null==o?void 0:o.configId,isFromSuggestion:null==o?void 0:o.isFromSuggestion,magicKey:null==o?void 0:o.magicKey};return(0,e.jsx)(d.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside"),key:`${null==t?void 0:t.layer}${n}`,title:o.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:r}=t||{};o&&(n||r)?b(e,t):b(e)})(o.suggestion,l)},ref:e=>{N(n,e)}},(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:r}}))}))},N=(e,t)=>{0!==e||j.current||(x(t),j.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(Ie,{isOpen:c,autoFocus:!1,reference:a,searchInputRef:f,isFocusWidtSearchInput:!0,toggle:y,id:h,className:(0,e.classNames)("result-list-con suggestion-list-con",s)},p.isUseCurrentLoation&&(0,e.jsx)(_e,{serviceList:m,isShowCurrentLocation:!0,onLocationChange:b,locationLoading:S,isGetLocationError:g,handleLocationLoadingChange:w}),(j.current=null,null==u?void 0:u.map(((t,o)=>(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"group","aria-label":null==t?void 0:t.layer},R(t))))),p.isShowRecentSearches&&(null===(n=null===(o=u[0])||void 0===o?void 0:o.suggestionItem)||void 0===n?void 0:n.length)>0&&(0,e.jsx)(d.DropdownItem,{divider:!0}),p.isShowRecentSearches&&(null===(l=null===(r=u[0])||void 0===r?void 0:r.suggestionItem)||void 0===l?void 0:l.length)>0&&(0,e.jsx)(d.Button,{role:"button",className:"clear-recent-search-con jimu-outline-inside",title:i("clearRecentSearches"),onClick:I},(0,e.jsx)(Oe,{className:"mr-2"}),i("clearRecentSearches"))))},{useEffect:ze,useRef:We}=e.React,He=t=>{const n=e.hooks.useTranslation(v),{reference:r,searchText:l,id:i,config:s,serviceList:a,isOpentResultListDefault:c,searchInputRef:g,searchResult:m,selectionList:p,openUtilityErrRemindInResult:f,toggleResultUtilityError:S,setResultFirstItem:y,handleDsIdOfSelectedResultItemChange:I}=t,{resultMaxNumber:x}=s,w=We([]),j=We(!1),R=We(null),N=We(!1),C=We((0,e.Immutable)({})),M=We({}),P=e.ReactRedux.useSelector((e=>e.appContext.isRTL));let k={};const T=(0,fe.useTheme)(),[D,O]=e.React.useState((0,e.Immutable)({})),[F,L]=e.React.useState(c),[E,A]=e.React.useState(!1),[U,$]=e.React.useState(u.Classic),[G,B]=e.React.useState(!1),[_,V]=e.React.useState(0),[q,J]=e.React.useState(o);ze((()=>{j.current=!1,ue(null==a?void 0:a.asMutable({deep:!0}),i)&&z()}),[m]),ze((()=>{ae(D)}),[D]),ze((()=>{(null==s?void 0:s.searchResultStyle)&&(null==s?void 0:s.searchResultStyle)!==U&&$(null==s?void 0:s.searchResultStyle)}),[s]),ze((()=>{w.current=[]}),[l]),ze((()=>{ce(U,F,G)}),[U,F,G]);const z=()=>{const t=Q(null==a?void 0:a.asMutable({deep:!0}),x,i);Promise.all([t]).then((t=>{j.current=!0;let o=D||(0,e.Immutable)({}),n=[];null==t||t.forEach((e=>{n=n.concat(e)}));const r={};n.forEach((e=>{const{records:t,configId:n,dsId:l,isGeocodeRecords:i,localDsId:s}=e;r[n]=t;const a=ne(t,n,l,i,s);o=o.setIn([n],a)})),C.current=o,O(o),M.current=r,V(_+1),ie()}))},W=()=>{var e;if(oe(a)<2)return!1;let t=0,o=0;for(const n in D){const r=te(s,n),l=null==r?void 0:r.icon;l&&(t+=1),(null===(e=D[n])||void 0===e?void 0:e.length)>0&&l&&(o+=1)}return o>0&&t>0},H=e.hooks.useEventCallback(((t,o,n=!1)=>null==t?void 0:t.map(((t,r)=>{var l,i,u,c;const{configId:v,value:g,recordId:m,outputDsId:p}=t,h=le(v,m),f=null===(i=null===(l=null==o?void 0:o.asMutable({deep:!0}))||void 0===l?void 0:l[v])||void 0===i?void 0:i.includes(m),S=te(s,v),y=null==S?void 0:S.icon,b=f?null===(u=null==T?void 0:T.ref.palette)||void 0===u?void 0:u.white:null===(c=null==T?void 0:T.sys.color)||void 0===c?void 0:c.primary.main,I=oe(a);return(0,e.jsx)(d.Button,{className:(0,e.classNames)("d-flex align-items-center jimu-outline-inside",{"item-p-l":n}),key:h,role:"button",active:f,title:g.join(", "),ref:e=>{K(r,e)},onClick:()=>{Y({isActive:f,key:h,recordId:m,dsId:p,configId:v})}},y&&1===I&&(0,e.jsx)(d.Icon,{className:"mr-2",color:b,size:16,icon:null==y?void 0:y.svg}),(0,e.jsx)("div",null,g.join(", ")))})))),K=(e,t)=>{0!==e||N.current||(y(t),N.current=!0)},Y=e.hooks.useEventCallback((t=>{var o,n,r,l,s,a;const{isActive:u,recordId:c,dsId:d,configId:v}=t,g=null===(r=null===(n=null===(o=C.current)||void 0===o?void 0:o[v])||void 0===n?void 0:n[0])||void 0===r?void 0:r.localDsId,m=null===(a=null===(s=null===(l=C.current)||void 0===l?void 0:l[v])||void 0===s?void 0:s[0])||void 0===a?void 0:a.isGeocodeRecords,p=X(m?d:g),h=u?[]:ee(v,c);e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(i,h)),I(c?d:null),c&&(!u&&Z(v),u?null==p||p.selectRecordsByIds([]):null==p||p.selectRecordsByIds([c]))})),Z=e=>{var t,o,n,r,l,i;const s=C.current;for(const a in s)if(e!==a){const e=null===(o=null===(t=s[a])||void 0===t?void 0:t[0])||void 0===o?void 0:o.outputDsId,u=null===(r=null===(n=null==s?void 0:s[a])||void 0===n?void 0:n[0])||void 0===r?void 0:r.localDsId,c=null===(i=null===(l=null==s?void 0:s[a])||void 0===l?void 0:l[0])||void 0===i?void 0:i.isGeocodeRecords,d=X(c?e:u);d&&d.selectRecordsByIds([])}},ee=(e,t)=>{var o;const n=(null===(o=M.current)||void 0===o?void 0:o[e])||[];return(null==n?void 0:n.filter((e=>(null==e?void 0:e.getId())===t)))||[]},ne=(t,o,n,r,l)=>{var i;const s=(null===(i=null==a?void 0:a[o])||void 0===i?void 0:i.displayFields)||[],u=[],c=e.i18n.getIntl();return null==t||t.forEach((e=>{const t=[];s.forEach((o=>{const n=e.getFormattedFieldValue(o.jimuName,c);(n||0===n)&&t.push(n)}));const i={value:t,configId:o,outputDsId:n,recordId:null==e?void 0:e.getId(),isGeocodeRecords:r,localDsId:l};u.push(i),re(i)})),u},re=e=>{!(null==k?void 0:k.recordId)&&e.recordId&&(k=e)},le=(e,t)=>`${e}_${t}`,ie=()=>{const e=ue(null==a?void 0:a.asMutable({deep:!0}),i);if(!(null==s?void 0:s.isAutoSelectFirstResult)||!(null==k?void 0:k.recordId)||E||!e)return;const{configId:t,recordId:o,outputDsId:n}=k,r=le(t,o);Y({isActive:!1,key:r,recordId:o,dsId:n,configId:t}),A(!0)},se=()=>{ce(U,!F,G),L(!F),V(_+1)},ae=e=>{var t;let o=0;for(const n in e){o+=(null===(t=null==e?void 0:e[n])||void 0===t?void 0:t.length)||0}const n=oe(a);B(0===n||0===o&&j.current)},ce=(e,t,n)=>{var l;let i=o;if(e===u.Compact)if(t||n)i=o;else{const e=(null===(l=null==r?void 0:r.current)||void 0===l?void 0:l.clientWidth)/2-15||0;i=P?[-e,0]:[e,0]}else i=o;J(i)};return(0,e.jsx)("div",{role:"group","aria-label":n("searchResults")},(0,e.jsx)(Ie,{isOpen:!0,isFocusWidtSearchInput:!0,autoFocus:!1,reference:r,searchInputRef:g,toggle:e=>{F&&L(!1)},id:i,offset:q,version:_,className:(0,e.classNames)("result-list-con",U!==u.Compact||G?"":F?"result-list-con-compact-open":"result-list-con-compact-close")},(0,e.jsx)("div",{className:"result-list-content"},!f&&(0,e.jsx)("div",{ref:R},G&&(0,e.jsx)(d.Button,{role:"button",className:"text-center",disabled:!0,title:n("noResult",{searchText:l})},n("noResult",{searchText:l})),!G&&(0,e.jsx)("div",null,U===u.Classic&&(0,e.jsx)("div",null,(0,e.jsx)(d.Button,{role:"button",className:"d-flex align-items-center show-result-button jimu-outline-inside",onClick:se,title:n("searchResults")},(0,e.jsx)("div",{className:"flex-grow-1 font-weight-bold"},n("searchResults")),!F&&l?(0,e.jsx)(h,null):(0,e.jsx)(b,null)),F&&(0,e.jsx)(d.DropdownItem,{divider:!0})),F&&(0,e.jsx)("div",null,(()=>{var t,o;const n=[];N.current=null;for(const r in D){const l=null===(t=null==D?void 0:D.asMutable({deep:!0}))||void 0===t?void 0:t[r],i=te(s,r),u=null==i?void 0:i.label,c=null==i?void 0:i.icon,v=oe(a),g=(0,e.jsx)("div",{key:`${r}_${u}_con`,role:"group",title:"label","aria-label":u},l.length>0&&(0,e.jsx)("div",null,v>1&&(0,e.jsx)(d.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,key:`${r}_${u}`,title:u},c&&(0,e.jsx)(d.Icon,{className:"mr-2",color:null===(o=null==T?void 0:T.sys.color)||void 0===o?void 0:o.primary.main,size:16,icon:null==c?void 0:c.svg}),u),H(l,p,W())));n.push(g)}return n})()),U===u.Compact&&(0,e.jsx)("div",{className:"show-result-button-style2-con"},F&&(0,e.jsx)(d.DropdownItem,{divider:!0}),(0,e.jsx)(d.Button,{role:"button",className:"d-flex align-items-center show-result-button show-result-button-style2 jimu-outline-inside",onClick:se,title:n("searchResults")},!F&&l?(0,e.jsx)(h,{size:10}):(0,e.jsx)(b,{size:10}))))),f&&(0,e.jsx)(Ne,{open:f,serviceList:a,toggleUtilityErrorRemind:S}))))};var Ke=s(50170),Qe=s.n(Ke),Xe=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const Ye=t=>{const o=window.SVG,{className:n}=t,r=Xe(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:l,src:Qe()},r)):e.React.createElement("svg",Object.assign({className:l},r))};var Ze=s(62838),et=s.n(Ze),tt=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const ot=t=>{const o=window.SVG,{className:n}=t,r=tt(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:l,src:et()},r)):e.React.createElement("svg",Object.assign({className:l},r))},{useSelector:nt}=e.ReactRedux,{useState:rt,useEffect:lt,useRef:it,useMemo:st}=e.React,at=t=>{var o,n,s,a,u;const c=e.hooks.useTranslation(v,d.defaultMessages),g=(0,fe.useTheme)(),m=nt((e=>null==e?void 0:e.queryObject)),p=nt((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),h=it((e=>{})),f=it(null),S=it(null),y=it(null),b=it(null),I=it(null),x=it(!1),w=it(!1),j=it(!1),R=it(null),N=it(null),C=it(null),M=it(!1),P=it(!1),k=it(null),T=it(null),O=it(null),L=it(!1),E=it(null),A=it(!1),U=it(null),$=it(null),G=it(!1),B=it(!1),_=it(!1),{config:V,className:z,reference:W,id:Y,isShowSearchInput:te,isInCurrentView:ne,isWidgetInCurrentPage:re,serviceList:ve,searchResult:ge,selectionList:me,handleServiceListChange:pe,clearSearchResult:he}=t,{isShowRecentSearches:Se,recentSearchesMaxNumber:ye,linkParam:be,searchResultView:Ie,resultMaxNumber:xe}=V,[we,je]=rt(null),[Re,Ne]=rt(!1),[Ce,Me]=rt(!1),[ke,Te]=rt(!1),[De,Oe]=rt([]),[Fe,Le]=rt({}),[Ee,Ae]=rt(!1),[Ue,$e]=rt(!1),[Ge,Be]=rt(null),[_e,Ve]=rt(!1),[qe,ze]=rt(!1),[We,Ke]=rt([]),[Qe,Xe]=rt(!1),[Ze,et]=rt(null),[tt,at]=rt(!1),[ut,ct]=rt(!1),dt=e.css`
    .input-wrapper {
      height: 100% !important;
    }
    .loading-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${e.polished.rem(16)};
      height: ${e.polished.rem(16)};
      min-width: ${e.polished.rem(16)};
      border: 2px solid ${null===(n=null===(o=null==g?void 0:g.sys.color)||void 0===o?void 0:o.secondary)||void 0===n?void 0:n.light};
      border-radius: 50%;
      border-top: 2px solid ${null===(a=null===(s=null==g?void 0:g.sys.color)||void 0===s?void 0:s.primary)||void 0===a?void 0:a.main};
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      box-sizing: border-box;
    }
    .search-button {
      width: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
    &.arrangement-Style1 {
      .search-button {
        border-radius: 0 ${e.polished.rem(4)} ${e.polished.rem(4)} 0;
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
      }
      .no-border-left .input-wrapper{
        border-radius: 0;
        border-left: none;
      }
    }
    &.arrangement-Style2 {
      & {
        padding-right: 1px;
      }
      .input-prefix-icon {
        color: var(--ref-palette-neutral-600);
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(32)} !important;
      }
    }
    &.arrangement-Style3 {
      .input-wrapper {
        background: none;
        border: none;
      }
      .search-button {
        background: none;
      }
    }
  `;lt((()=>{A.current&&ne&&re?($e(!1),e.lodash.defer((()=>{jt(!0)}))):$e(!0),ne&&re||Ae(!1)}),[ne,re]),lt((()=>{!_e&&L.current&&gt(!0,!1),L.current=_e}),[Ee,_e]),lt((()=>{Ee&&p===e.AppMode.Design&&Ae(!1)}),[p]),lt((()=>{h.current=e.lodash.debounce(yt,400)}),[V]),lt((()=>{qt(ve),bt(ve),!P.current&&ve&&(vt(ve),P.current=!0)}),[ve]);const vt=e.hooks.useEventCallback((e=>{var t;const o=ce(Y),{searchText:n,status:l}=o;if(l&&(l.isFromSuggestion=!0),n){if(!(null==V?void 0:V.datasourceConfig)||0===(null===(t=null==V?void 0:V.datasourceConfig)||void 0===t?void 0:t.length))return Gt(n,l),void Pt(n);clearTimeout(E.current),E.current=setTimeout((()=>{((e,t)=>{var o;let n=!0;for(const l in e){const i=e[l];let s;if(i.searchServiceType===r.FeatureService)ie(null===(o=null==i?void 0:i.useDataSource)||void 0===o?void 0:o.dataSourceId,ae(i.configId,t))||(n=!1);else{const e=null==i?void 0:i.outputDataSourceId;s=X(e),s||(n=!1)}}return n})(null==e?void 0:e.asMutable({deep:!0}),Y)&&Jt()>0?(Gt(n,l),Pt(n)):vt(e)}),300)}}));lt((()=>{x.current&&(pt(ve),mt(ve,w.current)),I.current=ve,ve&&(x.current=!0),w.current=null==V?void 0:V.enableFiltering,j.current=!0}),[ve,V.enableFiltering]);const gt=(e=!1,t=!0)=>{t&&Xe(!1),e||(B.current=!1),ze(e)},mt=(e,t)=>{if(!j.current)return!1;t!==(null==V?void 0:V.enableFiltering)&&(clearTimeout(S.current),S.current=setTimeout((()=>{var o;It(),he();for(const n in e){(null===(o=e[n])||void 0===o?void 0:o.searchServiceType)===r.FeatureService&&K(e[n],Y,n,t)}})))},pt=e=>{if(!j.current)return!1;const t=I.current||{},o=ht(e),n=ht(I.current),l=(null==n?void 0:n.filter((e=>!(null==o?void 0:o.includes(e)))))||[];Object.keys(e||{}).length!==Object.keys(t||{}).length&&(clearTimeout(S.current),S.current=setTimeout((()=>{It(!1),he(),null==l||l.forEach((e=>{var o,n;(null===(o=t[e])||void 0===o?void 0:o.searchServiceType)===r.FeatureService?K(t[e],Y,e,null==V?void 0:V.enableFiltering):wt(null===(n=t[e])||void 0===n?void 0:n.outputDataSourceId)}))})))},ht=e=>e?Object.keys(e).map((e=>e)):[],ft=(e=!1)=>{at(e)},St=(e=!1)=>{ct(e)},yt=e.hooks.useEventCallback((e=>{var t;const o=((e,t,o)=>{const n=[];for(const l in t){const i=t[l];let s;s=i.searchServiceType===r.FeatureService?q(e,o,i):D(e,i),n.push(s)}return Promise.all(n)})(e,null===(t=null==R?void 0:R.current)||void 0===t?void 0:t.asMutable({deep:!0}),V);Promise.all([o]).then((e=>{var t;const o=null==e?void 0:e[0];(null===(t=null==o?void 0:o.filter((e=>null==e?void 0:e.err)))||void 0===t?void 0:t.length)>0&&ft(!0),Ne(!1),o&&Oe(o),M.current||k.current&&Me(!0),M.current=!1})).catch((e=>{Ne(!1)}))})),bt=e.hooks.useEventCallback((e=>{if(!j.current)return!1;let t=!1;for(const o in e){const n=e[o];((null==n?void 0:n.searchServiceType)===r.FeatureService||(null==n?void 0:n.isSupportSuggest))&&(t=!0)}Te(t)})),It=(e=!0)=>{var t;Gt(""),Ne(!1),jt(!1),Pt("",!0),clearTimeout(O.current),e&&(null===(t=T.current)||void 0===t||t.focus())},xt=e.hooks.useEventCallback((()=>{var e,t;for(const o in ve)if((null===(e=ve[o])||void 0===e?void 0:e.searchServiceType)===r.GeocodeService){const e=null===(t=ve[o])||void 0===t?void 0:t.outputDataSourceId;wt(e)}})),wt=t=>{const o=X(t);o.selectRecordsByIds([]),le(o,e.DataSourceStatus.NotReady);const n=new e.DataRecordSetChangeMessage(Y,e.RecordSetChangeType.Remove,[t]);e.MessageManager.getInstance().publishMessage(n)},jt=e=>{A.current=e,e||$e(!0),Ae(e)},Rt=()=>{let e=!0;if(!b.current)return e;const t=b.current;for(const o in t){const n=t[o];if(e=!((null==n?void 0:n.magicKey)||(null==n?void 0:n.isFromSuggestion)),!e)break}return e},Nt=(e,t,o)=>{if(o)return Mt(),!1;Ct(e,t),Gt(e,t),Pt(e),T.current.focus()},Ct=(e,t)=>{const o=ce(Y)||{};if(e){if(o.searchText=e,t){const e={configId:null==t?void 0:t.configId};(null==t?void 0:t.magicKey)&&(e.magicKey=null==t?void 0:t.magicKey),o.status=e}de(Y,o)}else if(null==o?void 0:o.serviceEnabledList){const e={serviceEnabledList:null==o?void 0:o.serviceEnabledList};de(Y,e)}else de(Y,null)},Mt=()=>{var e;null===(e=T.current)||void 0===e||e.focus(),Xe(!0),gt(!0,!1)},Pt=e.hooks.useEventCallback(((e,t=!1)=>{if(Ee&&!t)return;e=null==e?void 0:e.trim(),Et(e),Me(!1),gt(!1),kt(),pe(R.current),M.current=!0;const o={serviceList:b.current,searchText:e,searchResultView:Ie,id:Y};Ct(e),Ne(!0),(e=>{const{serviceList:t,searchText:o,searchResultView:n}=e,i=[];for(const e in t){const s=t[e],{searchServiceType:a,resultMaxNumber:u}=s;if(a===r.GeocodeService){const e=n===l.ResultPanel?u:null,t=F(o,e,s,n);i.push(t)}}return Promise.all(i)})(o).then((t=>{var n;Ne(!1),(null===(n=null==t?void 0:t.filter((e=>"boolean"==typeof e)))||void 0===n?void 0:n.length)>0&&St(!0),M.current=!1,(null==V?void 0:V.enableFiltering)&&(H(o),Tt()),e&&Dt(e)}),(e=>{Ne(!1)}))})),kt=()=>{if(e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(Y,[])),Ze){const e=X(Ze);null==e||e.selectRecordsByIds([])}xt()},Tt=e.hooks.useEventCallback((()=>{var t;const o=[];for(const e in Fe){const n=Fe[e];let l;(null==n?void 0:n.searchServiceType)===r.FeatureService&&(l=null===(t=null==n?void 0:n.useDataSource)||void 0===t?void 0:t.dataSourceId,o.push(l))}e.MessageManager.getInstance().publishMessage(new e.DataSourceFilterChangeMessage(Y,o))})),Dt=e=>{Ut(),Ie===l.OtherWidgets?e&&(Lt()?At():Ot()):Ft()},Ot=()=>{if(!ue(b.current,Y))return clearTimeout(N.current),N.current=setTimeout((()=>{Ot()}),200),!1;const e=Q(b.current,xe,Y);Promise.all([e]).then((e=>{let t=[],o=[];null==e||e.forEach((e=>{t=t.concat(e)})),t.forEach((e=>{const t=(null==e?void 0:e.records)||[];o=o.concat(t)})),(null==o?void 0:o.length)>0?At():Ft()}))},Ft=()=>{const t=Q(b.current,xe,Y,!0);Promise.all([t]).then((t=>{let o=[];null==t||t.forEach((e=>{o=o.concat(e)})),se(Y,o,e.RecordSetChangeType.CreateUpdate)})),jt(!0)},Lt=()=>{let e=[];return De.forEach((t=>{e=e.concat(null==t?void 0:t.suggestionItem)})),e.length>0},Et=t=>{(t=>{const{searchText:o,id:n,recentSearchesMaxNumber:r,isShowRecentSearches:l}=t,i=e.urlUtils.getAppIdPageIdFromUrl().appId,s=ee(i,n);if(!l||!o)return!1;let a=Z(n);a.includes(o)||(a.unshift(o),a=a.splice(0,r||10),e.utils.setLocalStorage(s,escape(a.join("/@/"))))})({searchText:t,id:Y,recentSearchesMaxNumber:ye,isShowRecentSearches:Se})},At=()=>{var e;if(!(null==f?void 0:f.current))return!1;null===(e=null==f?void 0:f.current)||void 0===e||e.click()},Ut=()=>{if(!ue(b.current,Y))return clearTimeout(C.current),C.current=setTimeout((()=>{Ut()}),200),!1;const t=Ie===l.ResultPanel?xe:100,o=Q(b.current,t,Y,!0);Promise.all([o]).then((t=>{let o=[];null==t||t.forEach((e=>{o=o.concat(e)})),se(Y,o,e.RecordSetChangeType.CreateUpdate)}))},$t=st((()=>(e=>{let t,o;return(null==e?void 0:e.linkType)&&(t=null==e?void 0:e.openType,o={linkType:null==e?void 0:e.linkType},o.value=null==e?void 0:e.value),{linkTo:o,target:t}})(be)),[be]),Gt=(e,t)=>{Oe([]),je(e),k.current=e,Bt(e,t)},Bt=e.hooks.useEventCallback(((t,o)=>{var n,l,i;let s=ve;t=null==t?void 0:t.trim();for(const e in ve){const o=null===(l=null===(n=ve[e])||void 0===n?void 0:n.useDataSource)||void 0===l?void 0:l.dataSourceId;if(ve[e].searchServiceType===r.GeocodeService||!ie(o))continue;const a=X(o),u=(null===(i=ve[e].searchFields)||void 0===i?void 0:i.asMutable({deep:!0}))||[],c=J(t,u,a,ve[e].searchExact||!1),d=J(t,u,a,!1);s=s.setIn([e,"SQL"],c).setIn([e,"SuggestionSQL"],d).setIn([e,"searchText"],t)}R.current=s,((t,o)=>{const{configId:n,magicKey:r,isFromSuggestion:l}=o||{};let i=(0,e.Immutable)(t);const s={};for(const e in i)e===n&&(r||l)&&(r&&(i=i.setIn([n,"magicKey"],r||null)),l&&(i=i.setIn([n,"isFromSuggestion"],l||null)),s[n]=i[n]);(r||l)&&Object.keys(t).includes(n)&&(i=(0,e.Immutable)(s));b.current=null==i?void 0:i.asMutable({deep:!0}),Le(null==i?void 0:i.asMutable({deep:!0}))})(null==s?void 0:s.asMutable({deep:!0}),o)})),_t=e=>{if(!e&&Se){const e=Z(Y).map((e=>({suggestionHtml:e,suggestion:e,isRecentSearche:!0})));Ke([{suggestionItem:e,layer:null,icon:null}]),gt(!0)}},Vt=e=>{!e&&(null==V?void 0:V.isUseCurrentLoation)&&(gt(!0),(null==V?void 0:V.isShowRecentSearches)||Ke([{suggestionItem:[],layer:null,icon:null}]))},qt=e.hooks.useEventCallback((e=>{var t,o;let n;const r=Jt(e);for(const r in e)n=(null===(t=null==e?void 0:e[r])||void 0===t?void 0:t.hint)&&(null===(o=null==e?void 0:e[r])||void 0===o?void 0:o.hint);const l=(null==V?void 0:V.hint)||c("findAddressOrPlace");n=n||c("findAddressOrPlace");Be(1!==r?l:n)})),Jt=e.hooks.useEventCallback((e=>oe(e=e||ve))),zt=e=>{var t,o,n;40===e.keyCode&&U&&(Ce?null===(t=null==U?void 0:U.current)||void 0===t||t.focus():Ee?null===(o=null==y?void 0:y.current)||void 0===o||o.focus():qe&&(null===(n=null==$?void 0:$.current)||void 0===n||n.focus(),B.current=!0))},Wt=()=>{if(_e)return!0;if(Re||Ee)return!1;let e=!1;return(null==V?void 0:V.maxSuggestions)>0&&(e=Ce&&ke),e||(G.current=!1),e},Ht=()=>{Me(!1)};return(0,e.jsx)("div",{className:`h-100 align-items-center position-relative d-flex flex-grow-1 ${z||""} arrangement-${V.arrangementStyle}`,css:dt},(0,e.jsx)("div",{className:"h-100 flex-grow-1 search-input-con"},(0,e.jsx)("div",{className:"h-100 w-100",onKeyDown:e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key){const e=Wt();G.current=e,B.current=qe}zt(e)}},te&&(0,e.jsx)(d.TextInput,{value:we||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==o?void 0:o.length)>2;if(Gt(o),Ee&&Pt("",!0),jt(!1),!n||!ke)return Me(!1),0===(null==o?void 0:o.length)&&Pt("",!0),!1;!Re&&Ne(!0),h.current(o)},onFocus:e=>{if(G.current||B.current)return B.current=!1,G.current=!1,!1;_t(k.current),Vt(k.current)},onKeyUp:e=>{var t;if(!e||!e.target)return;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;13===e.keyCode&&Rt()&&(Gt(o),Pt(o)),zt(e)},onBlur:e=>{O.current=setTimeout((()=>{G.current||Me(!1),_.current||B.current||gt(!1)}),200)},className:(0,e.classNames)("h-100 w-100",{"no-border-left":(null===(u=null==V?void 0:V.datasourceConfig)||void 0===u?void 0:u.length)>1}),suffix:(0,e.jsx)("div",{className:"d-flex align-items-center"},(Re||_e)&&(0,e.jsx)("div",{className:"loading-con mr-1"}),we&&(null==we?void 0:we.length)>0&&(0,e.jsx)(d.Button,{icon:!0,type:"tertiary",size:"sm",title:c("clear"),onClick:()=>{It()}},(0,e.jsx)(ot,null))),prefix:V.arrangementStyle===i.Style2?(0,e.jsx)(Ye,{className:"input-prefix-icon"}):null,placeholder:Ge,title:we||Ge,ref:T})),we&&(0,e.jsx)(Pe,{canUseOutoutDsLength:Jt(),isOpen:Wt(),reference:W,searchText:we,searchSuggestion:De,toggel:Ht,onRecordItemClick:Nt,setSuggestionFirstItem:e=>{U.current=e},id:Y,config:V,toggleSuggestionUtilityError:ft,openUtilityErrRemindInSuggestion:tt,searchInputRef:T,serviceList:ve}),!we&&((null==V?void 0:V.isUseCurrentLoation)||(null==V?void 0:V.isShowRecentSearches)||!_e)&&(0,e.jsx)(Je,{serviceList:oe(Fe)>0?(0,e.Immutable)(Fe):ve,isOpen:qe||_e,reference:W,isGetLocationError:Qe,recentSearchesData:We,toggel:Ht,onRecordItemClick:Nt,clearSearches:()=>{(t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=ee(o,t);e.utils.setLocalStorage(n,"")})(Y),Ke([]),ze(!1)},setSuggestionFirstItem:e=>{$.current=e},id:Y,config:V,searchInputRef:T,locationLoading:_e,handleLocationLoadingChange:e=>{e?(Ve(e),_.current=e):setTimeout((()=>{Ve(e),_.current=e}),300)}}),Ee&&(0,e.jsx)(He,{serviceList:(0,e.Immutable)(Fe),config:V,reference:W,searchText:we,id:Y,setResultFirstItem:e=>{y.current=e},isOpentResultListDefault:Ue,searchInputRef:T,searchResult:ge,selectionList:me,openUtilityErrRemindInResult:ut,handleDsIdOfSelectedResultItemChange:e=>{et(e)},toggleResultUtilityError:St})),V.arrangementStyle!==i.Style2&&(0,e.jsx)(d.Button,{className:"search-button h-100",type:V.arrangementStyle===i.Style3?"tertiary":"primary",icon:!0,onClick:()=>{(e=>{Rt()&&Pt(e)})(we)},title:c("SearchLabel")},(0,e.jsx)(Ye,null)),Ie===l.OtherWidgets&&(0,e.jsx)("div",{className:"search-link-con"},(0,e.jsx)(d.Link,{ref:f,to:null==$t?void 0:$t.linkTo,target:null==$t?void 0:$t.target,queryObject:m})))},ut=t=>{const{config:o,id:n,serviceList:l,dsStatus:i,handleSearchResultChange:s,handleSelectionListChange:a,handleDsStatusChange:u}=t,c=(t,l)=>{if(t.searchServiceType===r.GeocodeService){const r=null==t?void 0:t.outputDataSourceId,i={dataSourceId:r,mainDataSourceId:r},s={where:"1=1",sqlExpression:null,pageSize:o.resultMaxNumber,outFields:["*"],page:1,returnGeometry:!0};return(0,e.jsx)("div",{key:`${l}_con`},r&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(i),query:s,key:`${l}_outputDataSource`,onDataSourceInfoChange:e=>{v(t,l)},onDataSourceStatusChange:e=>{v(t,l,e)},onSelectionChange:e=>{d(e,l)},widgetId:n}))}if(t.searchServiceType===r.FeatureService){const o=null==t?void 0:t.useDataSource,r=function(t){const{searchText:o,useDataSource:n}=t,r=null==t?void 0:t.SQL,l=o?(null==r?void 0:r.sql)||"1=0":"1=1",i=o&&(null==r?void 0:r.sql)?r:null,s=z(t.searchFields,t.displayFields,null==n?void 0:n.dataSourceId);return(0,e.Immutable)({outFields:s,where:l,sqlExpression:i,returnGeometry:!0})}(null==t?void 0:t.asMutable({deep:!0})),s=ae(l,n);return(0,e.jsx)("div",{key:`${l}_con`},o&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(o),query:r,key:`${l}_useDataSource`,onDataSourceInfoChange:e=>{v(t,l)},onSelectionChange:e=>{d(e,l)},onDataSourceCreated:e=>{e.setListenSelection(!0)},onDataSourceStatusChange:t=>{u((0,e.Immutable)(i.set(l,t)))},localId:s}))}},d=(e,t)=>{a(e,t)},v=(t,l,a)=>{const{searchServiceType:c}=t;switch(c){case r.GeocodeService:B(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));s(l,o)}));break;case r.FeatureService:W(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber,n).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));s(l,o)}))}a&&u((0,e.Immutable)(i.set(l,a)))};return(0,e.jsx)("div",null,(()=>{const e=[];for(const t in l)e.push(c(l[t],t));return e})())},ct=(e,t=0)=>{let o="Default Address";return null==e||e.forEach((n=>{o=t?`${o}${t}`:o,n.jimuName===o&&(o=ct(e,t+=1))})),o};var dt=function(e,t,o,n){return new(o||(o=Promise))((function(r,l){function i(e){try{a(n.next(e))}catch(e){l(e)}}function s(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const vt={jimuName:x,alias:"ADDRESS",type:e.JimuFieldType.String,name:x},gt=t=>dt(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))}));class mt extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.9.0",description:"For geocode service, use arrary of Schema to set displayFields",upgrader:e=>{var t,o;const n=null===(o=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===o?void 0:o.map((e=>((null==e?void 0:e.searchServiceType)===r.FeatureService||(null==e?void 0:e.displayFields)||(e.displayFields=[vt],e.addressFields=[vt],e.defaultAddressFieldName=vt.jimuName),e)));return e.setIn(["datasourceConfig"],n)}},{version:"1.10.0",description:"For locator service, need to save support for suggest in config",upgrader:t=>dt(this,void 0,void 0,(function*(){var o,n;const l=null===(n=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.map((t=>(null==t?void 0:t.searchServiceType)===r.FeatureService?Promise.resolve(t):gt(null==t?void 0:t.useUtility).then((o=>dt(this,void 0,void 0,(function*(){return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[n]=e;return n(o,{query:{f:"json"},responseType:"json"}).then((e=>{var o;const n=(null==e?void 0:e.data)||{};if(null==n?void 0:n.capabilities){const e=(null===(o=null==n?void 0:n.capabilities)||void 0===o?void 0:o.split(","))||[],r=null==e?void 0:e.includes("Suggest");return t.isSupportSuggest=r,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}),(e=>Promise.resolve(t)))})))))),i=l?yield Promise.all(l):[];return t.setIn(["datasourceConfig"],i)}))},{version:"1.12.0",description:'For old search widgets, "enableFiltering" needs to be "true" by default, and the default value of "searchResultStyle" should be "Classic"',upgrader:t=>dt(this,void 0,void 0,(function*(){const o=yield(()=>dt(this,void 0,void 0,(function*(){var o,n;const l=null===(n=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.map((t=>dt(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===r.FeatureService?Promise.resolve(t):gt(null==t?void 0:t.useUtility).then((o=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((n=>{const[r]=n;return r(o,{query:{f:"json"},responseType:"json"}).then((o=>{const n=(null==o?void 0:o.data)||{};if(null==n?void 0:n.capabilities){const o=(null==n?void 0:n.candidateFields)||[],{addressFieldsSchema:r}=((t=[])=>{const o=null==t?void 0:t.map((t=>({jimuName:null==t?void 0:t.alias,alias:null==t?void 0:t.alias,type:e.JimuFieldType.String,name:null==t?void 0:t.alias}))),n=ct(o,0),r={jimuName:n,alias:n,type:e.JimuFieldType.String,name:n};return o.unshift(r),{addressFieldsSchema:o,defaultAddressFieldName:n}})(o),l=((null==t?void 0:t.addressFields)||[]).concat(r);return t.addressFields=l,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return l?yield Promise.all(l):[]})))();return t.setIn(["enableFiltering"],!0).setIn(["datasourceConfig"],o).setIn(["searchResultStyle"],u.Classic)}))},{version:"1.15.0",description:"Add spatialReference for locator service",upgrader:t=>dt(this,void 0,void 0,(function*(){let o=!1;const n=yield(()=>dt(this,void 0,void 0,(function*(){var n,l;const i=null===(l=null===(n=null==t?void 0:t.asMutable({deep:!0}))||void 0===n?void 0:n.datasourceConfig)||void 0===l?void 0:l.map((t=>dt(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===r.FeatureService?Promise.resolve(t):gt(null==t?void 0:t.useUtility).then((n=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[r]=e;return r(n,{query:{f:"json"},responseType:"json"}).then((e=>{const n=(null==e?void 0:e.data)||{};return(null==n?void 0:n.spatialReference)?(o=!0,t.spatialReference=n.spatialReference,Promise.resolve(t)):Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return i?yield Promise.all(i):[]})))(),l=t.setIn(["datasourceConfig"],n);return o?l:t}))}]}}const pt=new mt;var ht=function(e,t,o,n){return new(o||(o=Promise))((function(r,l){function i(e){try{a(n.next(e))}catch(e){l(e)}}function s(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const{useEffect:ft,useState:St,useRef:yt}=e.React,bt=o=>{const{config:n,id:l,useDataSources:s}=o,{resultMaxNumber:a}=n,u=yt(null),c=yt((0,e.Immutable)({})),[d,v]=St((0,e.Immutable)([])),[g,m]=St(!1),[p,h]=St(null),[f,S]=St((0,e.Immutable)({})),[y,b]=St((0,e.Immutable)({})),[I,x]=St((0,e.Immutable)({}));ft((()=>{R()}),[n]);const w=e.css`
    & {
      height: ${e.polished.rem(32)};
      margin-top: 1px;
      margin-left: 1px;
    }
    &.search-con-Style3 {
      border-bottom: 1px solid var(--ref-palette-neutral-500);
    }
  `,j=e=>{e&&v(e),T(e)},R=()=>ht(void 0,void 0,void 0,(function*(){const t=((null==n?void 0:n.datasourceConfig)||(0,e.Immutable)([])).map((e=>ht(void 0,void 0,void 0,(function*(){const t=N(e);let o=null==e?void 0:e.setIn(["enable"],t);return(null==e?void 0:e.useUtility)&&(yield C(null==e?void 0:e.useUtility).then((e=>{o=o.setIn(["geocodeURL"],e)}))),Promise.resolve(null==o?void 0:o.asMutable({deep:!0}))}))));yield Promise.all(t).then((t=>{v((0,e.Immutable)(t)),T((0,e.Immutable)(t))}))})),N=e=>{if(d&&0!==(null==d?void 0:d.length)){let t=!0;return null==d||d.forEach((o=>{(null==e?void 0:e.configId)===(null==o?void 0:o.configId)&&(t=!!(null==o?void 0:o.enable))})),t}{const t=ce(l),o=null==t?void 0:t.serviceEnabledList;return!o||o.includes(null==e?void 0:e.configId)}},C=t=>ht(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))})),M=e=>{h(e)},P=()=>(null==n?void 0:n.arrangementStyle)===i.Style1||(null==n?void 0:n.arrangementStyle)===i.Style2||(null==n?void 0:n.arrangementStyle)===i.Style3||g,k=e=>{m(e)},T=t=>{var o;let n=(0,e.Immutable)({});null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o||o.forEach((e=>{if(!(null==e?void 0:e.enable))return!1;const{configId:t}=e;let o;o=(null==e?void 0:e.searchServiceType)===r.GeocodeService?O(e):D(e),n=n.setIn([t],o)})),h(n)},D=e.hooks.useEventCallback((e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===r.GeocodeService)return!1;const{configId:o,useDataSource:l,displayFields:i,searchFields:s,searchExact:u,hint:c,searchServiceType:d}=e,v=(null===(t=null==p?void 0:p[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},g={useDataSource:l,displayFields:i,searchFields:s,searchExact:u,maxSuggestions:null==n?void 0:n.maxSuggestions,resultMaxNumber:a,hint:c,searchServiceType:d,configId:o};return Object.assign(v,g)})),O=e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===r.FeatureService)return!1;const{configId:o,hint:l,geocodeURL:i,outputDataSourceId:s,label:u,searchServiceType:c,spatialReference:d,singleLineFieldName:v,displayFields:g,defaultAddressFieldName:m,addressFields:h,isSupportSuggest:f,useUtility:S}=e,y=(null===(t=null==p?void 0:p[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},b={hint:l,geocodeURL:i,outputDataSourceId:s,icon:null==e?void 0:e.icon,maxSuggestions:null==n?void 0:n.maxSuggestions,resultMaxNumber:a,label:u,searchServiceType:c,configId:o,singleLineFieldName:v||"",displayFields:g,defaultAddressFieldName:m,addressFields:h||[],isSupportSuggest:f,useUtility:S,spatialReference:d};return Object.assign(y,b)},F=(t,o)=>{const n=f.set(t,o);S((0,e.Immutable)(n))},L=()=>{S((0,e.Immutable)({}))},E=e.hooks.useEventCallback(((e,t)=>{const o=c.current.setIn([t],e);b(o),c.current=o})),A=e=>{x(e)};return(0,e.jsx)(t.ViewVisibilityContext.Consumer,null,(({isInView:o,isInCurrentView:r})=>{const i=!o||r;return(0,e.jsx)(t.PageVisibilityContext.Consumer,null,(t=>{var o;return(0,e.jsx)("div",{className:"widget-search jimu-widget"},(0,e.jsx)("div",{className:`d-flex w-100 align-items-center search-con-${n.arrangementStyle}`,css:w,ref:u},(0,e.jsx)("div",null,(null===(o=null==n?void 0:n.datasourceConfig)||void 0===o?void 0:o.length)>1&&P()&&(0,e.jsx)(he,{className:"h-100",config:n,dsStatus:I,datasourceConfig:d,id:l,useDataSources:s,onDatasourceConfigChange:j})),(0,e.jsx)(at,{id:l,className:"flex-grow-1 h-100",reference:u,config:n,isShowSearchInput:P(),onShowSearchInputChange:k,isInCurrentView:i,isWidgetInCurrentPage:t,handleServiceListChange:M,searchResult:f,serviceList:p,clearSearchResult:L,selectionList:y}),(0,e.jsx)(ut,{id:l,config:n,serviceList:p,dsStatus:I,handleSearchResultChange:F,handleSelectionListChange:E,handleDsStatusChange:A})))}))}))};bt.versionManager=pt;const It=bt;function xt(e){s.p=e}})(),a})())}}}));