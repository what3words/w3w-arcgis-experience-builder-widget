System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-core/react","jimu-ui/basic/list-tree","jimu-for-builder","jimu-ui/basic/color-picker","jimu-layouts/layout-runtime","jimu-ui/advanced/style-setting-components"],(function(e,t){var i={},a={},s={},l={},o={},n={},r={},d={},c={},h={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.CONSTANTS=e.CONSTANTS,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.Immutable=e.Immutable,i.JimuFieldType=e.JimuFieldType,i.React=e.React,i.classNames=e.classNames,i.css=e.css,i.jsx=e.jsx,i.polished=e.polished,i.urlUtils=e.urlUtils},function(e){a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.DistanceUnits=e.DistanceUnits,a.Icon=e.Icon,a.Label=e.Label,a.Radio=e.Radio,a.Select=e.Select,a.Switch=e.Switch,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.defaultMessages=e.defaultMessages},function(e){s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper},function(e){l.DataSourceSelector=e.DataSourceSelector,l.FieldSelector=e.FieldSelector,l.FieldSelectorWithFullTextIndex=e.FieldSelectorWithFullTextIndex,l.dataComponentsUtils=e.dataComponentsUtils},function(e){o.Fragment=e.Fragment},function(e){n.List=e.List,n.TreeItemActionType=e.TreeItemActionType},function(e){r.builderAppSync=e.builderAppSync},function(e){d.ThemeColorPicker=e.ThemeColorPicker},function(e){c.defaultMessages=e.defaultMessages},function(e){h.FontStyle=e.FontStyle,h.InputUnit=e.InputUnit}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},26490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3.154 3.154a.527.527 0 0 1 .746 0l1.317 1.317A8.6 8.6 0 0 1 8 4c2.667 0 5.667 1.333 7 4-.696 1.393-1.847 2.422-3.168 3.087l1.014 1.013a.527.527 0 1 1-.746.746l-1.317-1.317A8.6 8.6 0 0 1 8 12c-2.667 0-5.667-1.333-7-4 .696-1.393 1.847-2.422 3.168-3.087L3.154 3.9a.527.527 0 0 1 0-.746m1.698 2.443C3.726 6.087 2.782 6.882 2 8c1.422 2.033 3.382 3 6 3a8.7 8.7 0 0 0 2.03-.225l-.675-.674A2.5 2.5 0 0 1 5.9 6.644zm6.296 4.805C12.275 9.913 13.218 9.119 14 8c-1.422-2.033-3.382-3-6-3q-1.088 0-2.03.225l.675.674a2.5 2.5 0 0 1 3.457 3.456zM6.5 8c0-.221.048-.431.134-.62l1.987 1.986A1.5 1.5 0 0 1 6.5 8m.88-1.366 1.986 1.987a1.5 1.5 0 0 0-1.987-1.987" clip-rule="evenodd"></path></svg>'},73529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 12c-2.667 0-5.667-1.333-7-4 1.333-2.667 4.333-4 7-4s5.667 1.333 7 4c-1.333 2.667-4.333 4-7 4m0-7c-2.618 0-4.578.967-6 3 1.422 2.033 3.382 3 6 3s4.578-.967 6-3c-1.422-2.033-3.382-3-6-3m0 5.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0-1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},778:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.829 2.535a.909.909 0 0 0-1.657 0L2.291 13.356a.456.456 0 0 0 .831.377L4.818 10h6.365l1.696 3.733a.456.456 0 0 0 .831-.377zM5.272 9 8 3l2.729 6z" clip-rule="evenodd"></path></svg>'},8377:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA5IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA5IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkzIiBoZWlnaHQ9IjU0IiByeD0iMiIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMzIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMzIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMTIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iMzgiIGhlaWdodD0iOCIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMTQiIHk9IjE0IiB3aWR0aD0iMjgiIGhlaWdodD0iNCIgZmlsbD0iIzE4MTgxOCIvPg0KPHBhdGggZD0iTTQ0IDE1SDQ4TDQ2IDE3TDQ0IDE1WiIgZmlsbD0iIzE4MTgxOCIvPg0KPHJlY3QgeD0iNTIiIHk9IjI0IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNTIiIHk9IjMyIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjM5IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjQ2IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjUzIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjI0IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNzMiIHk9IjMyIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjM5IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjQ2IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjUzIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPC9zdmc+DQo="},79226:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA5IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA5IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkzIiBoZWlnaHQ9IjU0IiByeD0iMiIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMzIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMzIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMTIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjE5IiB3aWR0aD0iODUiIGhlaWdodD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjE5IiB3aWR0aD0iMTYiIGhlaWdodD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMTIiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMzAiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNDgiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjI0IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNTIiIHk9IjMyIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjM5IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjQ2IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjUzIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjI0IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNzMiIHk9IjMyIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjM5IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjQ2IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjUzIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPC9zdmc+DQo="},79244:e=>{"use strict";e.exports=i},68972:e=>{"use strict";e.exports=o},4108:e=>{"use strict";e.exports=r},41496:e=>{"use strict";e.exports=c},14321:e=>{"use strict";e.exports=a},13089:e=>{"use strict";e.exports=l},79298:e=>{"use strict";e.exports=s},15562:e=>{"use strict";e.exports=h},54337:e=>{"use strict";e.exports=d},98640:e=>{"use strict";e.exports=n}},t={};function g(i){var a=t[i];if(void 0!==a)return a.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,g),s.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var i in t)g.o(t,i)&&!g.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},g.p="";var u={};return g.p=window.jimuConfig.baseUrl,(()=>{"use strict";g.r(u),g.d(u,{__set_webpack_public_path__:()=>L,default:()=>B});var e,t,i,a,s,l=g(79244),o=g(14321),n=g(79298),r=g(13089);!function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(e||(e={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(t||(t={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(i||(i={})),function(e){e.Fit="FIT",e.Fixed="FIXED"}(a||(a={})),function(e){e.View="VIEW",e.Add="ADD"}(s||(s={}));const d={newSheet:"New sheet",sheetStyle:"Arrangement style",layerConfig:"Sheet configuration",enableAttachements:"Show attachments",enableSearch:"Search",searchFields:"Select searching fields",fullMatch:"Exact match",allowCsv:"Allow exporting to CSV",enableSelect:"Select records",enableEdit:"Allow editing",showCount:"Show record count",enableRefresh:"Refresh",configFields:"Configure fields",dropdown:"Dropdown",configTips:"Select fields for initial display",tableBlankStatus:'Click the "{SheetString}" button to add and configure data sheets.',selectFields:"Select fields",checkAll:"Check all",uncheckAll:"Uncheck all",editable:"Editable",editableCount:"{count} Editable",tableOptions:"Table options",columnSize:"Column sizing",fitToData:"Fit to data",columnWidth:"Column width",updateText:"Last update text",layerHonorSetting:"Use layer settings",layerCustomize:"Customize",deleteRecords:"Delete records"};var c=g(68972),h=g(98640),p=g(4108),m=g(73529),I=g.n(m),S=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const b=e=>{const t=window.SVG,{className:i}=e,a=S(e,["className"]),s=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:s,src:I()},a)):l.React.createElement("svg",Object.assign({className:s},a))};var D=g(26490),f=g.n(D),y=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const v=e=>{const t=window.SVG,{className:i}=e,a=y(e,["className"]),s=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:s,src:f()},a)):l.React.createElement("svg",Object.assign({className:s},a))};var M=g(778),j=g.n(M),T=g(54337),x=g(41496),C=g(15562);const{OUTPUT_DATA_VIEW_ID:N}=l.CONSTANTS,w=["bold"];class z extends l.React.PureComponent{constructor(e){super(e),this.partSupportedDsTypes=(0,l.Immutable)([l.AllDataSourceTypes.FeatureLayer,l.AllDataSourceTypes.SceneLayer,l.AllDataSourceTypes.BuildingComponentSubLayer,l.AllDataSourceTypes.OrientedImageryLayer,l.AllDataSourceTypes.ImageryLayer]),this.supportedDsTypes=(0,l.Immutable)([l.AllDataSourceTypes.FeatureLayer,l.AllDataSourceTypes.SceneLayer,l.AllDataSourceTypes.WebMap,l.AllDataSourceTypes.WebScene,l.AllDataSourceTypes.MapService,l.AllDataSourceTypes.FeatureService,l.AllDataSourceTypes.SceneService,l.AllDataSourceTypes.GroupLayer,l.AllDataSourceTypes.BuildingComponentSubLayer,l.AllDataSourceTypes.BuildingGroupSubLayer,l.AllDataSourceTypes.BuildingSceneLayer,l.AllDataSourceTypes.OrientedImageryLayer,l.AllDataSourceTypes.ImageryLayer]),this.batchDsTypes=(0,l.Immutable)([l.AllDataSourceTypes.WebMap,l.AllDataSourceTypes.WebScene,l.AllDataSourceTypes.MapService,l.AllDataSourceTypes.FeatureService,l.AllDataSourceTypes.SceneService,l.AllDataSourceTypes.GroupLayer,l.AllDataSourceTypes.BuildingGroupSubLayer,l.AllDataSourceTypes.BuildingSceneLayer]),this.nameChange=e=>{const t=e.target.value;this.setState({itemLabel:t})},this.nameAccept=e=>{(e=""===(e=null==e?void 0:e.trim())?this.props.name:e)!==this.state.itemLabel&&this.setState({itemLabel:e}),this.props.optionChange("name",e)},this.getUncheckState=(e=[],t)=>{let i,a=!1;if(this.state)i=this.state.dataSource;else{if(!t)return a;const e=t.lastIndexOf("-"),s=t.substring(0,e);i=l.DataSourceManager.getInstance().getDataSource(s)}const s=null==i?void 0:i.getLayerDefinition();return e.forEach((e=>{const t=this.getFieldEditable(s,e.jimuName);!e.editAuthority&&t&&(a=!0)})),a},this.handleCheckboxChange=e=>{const t=e.currentTarget;if(t)if("enableEdit"===t.dataset.field){const{tableFields:e}=this.props,i=e.map((e=>Object.assign(Object.assign({},e),{editAuthority:e.editable})));this.props.multiOptionsChange({enableEdit:t.checked,tableFields:i})}else this.props.optionChange(t.dataset.field,t.checked)},this.changeMatchType=(e,t)=>{this.props.optionChange("searchExact",t)},this.formatMessage=(e,t)=>{const i=Object.assign({},d,o.defaultMessages,x.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.displaySelectedFields=e=>this.formatMessage("numSelected",{number:e.length}),this.filterSearchFields=e=>{const{searchFields:t}=this.props,i=e.map((e=>e.jimuName));return t.filter((e=>i.includes(e)))},this.getFieldEditable=(e,t)=>{const i=((null==e?void 0:e.fields)||[]).find((e=>e.name===t));return!i||(null==i?void 0:i.editable)},this.mergeArray=(e,t)=>{const i=e.concat(t),a=new Set(i);return Array.from(a)},this.onFieldChange=e=>{if(!e)return;const{dataSource:t}=this.state,{id:i,useDataSource:a,tableFields:s,onDataSourceFieldsChange:l}=this.props,o=null==t?void 0:t.getLayerDefinition(),n=e.filter((e=>e)).map((e=>{const t=this.getFieldEditable(o,e.jimuName),i=s.find((t=>t.jimuName===e.jimuName)),a=!i||(null==i?void 0:i.visible),l=i?null==i?void 0:i.editAuthority:t;return Object.assign(Object.assign({},e),{editAuthority:l,editable:t,visible:a})})),r=this.filterSearchFields(n);l(a,{id:i,usedFields:e.map((e=>e.jimuName))}),this.props.multiOptionsChange({searchFields:r,tableFields:n})},this.onDataSourceCreated=e=>{this.setState({dataSource:e},(()=>{this.checkIsDsAutoRefreshSettingOpen(e)&&this.props.optionChange("updateText",!0)}))},this.onDataSourceInfoChange=e=>{e&&this.state.dataSource&&this.checkIsDsAutoRefreshSettingOpen(this.state.dataSource)&&this.props.optionChange("updateText",!0)},this.getSearchingFields=()=>{const e=[],{tableFields:t}=this.props;return t.length>0&&t.forEach((t=>{t.type===l.JimuFieldType.String&&e.push({value:t.jimuName||t.name,label:t.alias||t.name})})),e},this.handleChooseSearchingFieldsChange=e=>{const{widgetId:t}=this.props;0===e.length&&p.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:t,propKey:"optionChangeSuggestion",value:!0}),this.props.optionChange("searchFields",e.map((e=>e.name)))},this.onSearchPlaceholderChange=e=>{var t;const i=e.target.value;(null===(t=this.props)||void 0===t?void 0:t.searchHint)!==i&&this.props.optionChange("searchHint",i)},this.getSelectModeOptions=()=>[(0,l.jsx)("option",{key:t.Single,value:t.Single},this.formatMessage("single")),(0,l.jsx)("option",{key:t.Multiple,value:t.Multiple},this.formatMessage("multiple"))],this.getFieldsFromDatasource=()=>{const{useDataSource:e}=this.props,t=l.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),i=null==t?void 0:t.getSchema(),a=(null==i?void 0:i.fields)?Object.values(null==i?void 0:i.fields):[],s=["CreationDate","Creator","EditDate","Editor","GlobalID"],o=null==t?void 0:t.getLayerDefinition(),n=(null==o?void 0:o.fields)||[];let r=a.filter((e=>!s.includes(e.jimuName))).map((e=>{const t=n.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,editable:i,visible:!0})}));return(null==r?void 0:r.length)>50&&(r=r.slice(0,50)),{allFields:a,tableFields:r}},this.checkFieldsExist=(e,t)=>{let i=!1;for(const a of e)if(a.jimuName===t.jimuName){i=!0;break}return i},this.handleHonorTypeChange=e=>{this.props.multiOptionsChange({layerHonorMode:e,enableDelete:!1})},this.handleListBoxAll=(e,t)=>{const{tableFields:i}=this.props,a=i.map((i=>{const a=this.getFieldEditable(t,i.jimuName);return Object.assign(Object.assign({},i),{editAuthority:!!a&&e})}));this.setState({hasUncheck:!e}),this.props.optionChange("tableFields",a)},this.getCurrentEditField=e=>{const{tableFields:t}=this.props;return t.find((t=>t.jimuName===e))},this.toggleFieldVisible=e=>{const{tableFields:t}=this.props,i=t.findIndex((t=>t.jimuName===e)),a=t[i].visible;t[i].visible=!a,this.props.optionChange("tableFields",t)},this.onKeyUp=(e,t)=>{e&&"Enter"===e.key&&this.toggleFieldVisible(t)},this.handleColumnStyleChange=(e,t)=>{const{columnSetting:i}=this.props;if(i)i[e]=t,this.props.optionChange("columnSetting",i);else{const i={responsiveType:a.Fixed,columnWidth:200};i[e]=t,this.props.optionChange("columnSetting",i)}},this.handleHeaderStyleChange=(e,t)=>{const{headerFontSetting:i}=this.props;if(i)i[e]=t,this.props.optionChange("headerFontSetting",i);else{const i={backgroundColor:"",fontSize:14,bold:!1,color:""};i[e]=t,this.props.optionChange("headerFontSetting",i)}},this.checkIsDsAutoRefreshSettingOpen=e=>{if(!e)return!1;return((null==e?void 0:e.getAutoRefreshInterval())||0)>0},this.getDsCapabilities=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),this.onFilterDs=e=>{let t=!1;if(this.batchDsTypes.includes(e.type)){const i=this.dsManager.getDataSource(e.id).getAllChildDataSources();0===(null==i?void 0:i.length)&&(t=!0)}return t},this.state={dataSource:void 0,itemLabel:e.name||"",hasUncheck:this.getUncheckState(e.tableFields,e.id)},this.colRef=l.React.createRef(),this.dsManager=l.DataSourceManager.getInstance()}componentDidUpdate(e,t){const{name:i,useDataSource:a,tableFields:s,optionChange:l}=this.props;if(i!==e.name&&this.setState({itemLabel:this.props.name||""}),!s)return;const o=this.dsManager.getDataSource(null==a?void 0:a.dataSourceId);if(!o)return;const n=null==o?void 0:o.getSchema();let r=!1;const d=((null==n?void 0:n.fields)?Object.values(null==n?void 0:n.fields):[]).map((e=>e.jimuName));for(const e of s)if(!d.includes(e.jimuName)){r=!0;break}if(r){const{tableFields:e}=this.getFieldsFromDatasource();l("tableFields",e)}}getStyle(e){return l.css`
      .layer-config-panel {
        .panel-inner {
          .title {
            max-width: 70%;
          }
        }
        .setting-container {
          height: 100%;
          overflow: auto;
          .fields-list-header {
            background: ${e.ref.palette.neutral[300]};
            border-bottom: 1px solid ${e.ref.palette.neutral[600]};
            height: 34px;
            width: 100%;
            flex-wrap: nowrap;
            .jimu-checkbox {
              margin-top: 2px;
            }
          }
          .selected-fields-con{
            margin-top: 0;
            .selected-fields-list {
              flex: 1;
              max-height: 265px;
              overflow-y: auto;
            }
            .jimu-tree-item{
              background: ${e.ref.palette.neutral[300]};
              border-bottom: 1px solid ${e.ref.palette.neutral[400]};
              .jimu-tree-item__content{
                div:first-of-type{
                  padding-left: 2px;
                }
                .jimu-tree-item__body{
                  background: ${e.ref.palette.neutral[300]};
                }
              }
            }
          }
          .table-options {
            .table-options-item {
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            }
            .select-option {
              margin-bottom: 8px;
            }
          }
          .ds-container {
            position: absolute;
            display: none;
          }
          .component-field-selector {
            .search-input {
              width: 100%;
            }
            .field-list {
              max-height: 300px;
            }
          }
          .config-word-break {
            word-wrap: break-word;
          }
          .last-setting-section {
            border-bottom: unset;
          }
        }
      }
    `}render(){var e,s;const{useDataSource:d,optionChange:g,theme:u,appTheme:m,tableFields:I,searchFields:S,searchExact:D,searchHint:f,enableEdit:y,enableSearch:M,widgetId:x,dataSourceChange:z,headerFontSetting:P,columnSetting:A,updateText:k,id:H,layerHonorMode:F,newAddFlag:O}=this.props,{dataSource:R,itemLabel:W,hasUncheck:Y}=this.state,B=R&&R.getLayerDefinition(),L=null==R?void 0:R.getSchema(),Q=null==I?void 0:I.map((e=>{var t;const i=(null===(t=null==L?void 0:L.fields)||void 0===t?void 0:t[e.jimuName])||{};return Object.assign(Object.assign({},e),i)})),E=[];I&&I.length>0&&I.forEach((e=>{E.push(e.jimuName)}));const{allFields:J}=this.getFieldsFromDatasource(),K=(null==R?void 0:R.url)&&(null==R?void 0:R.dataViewId)!==N,U=null==B?void 0:B.capabilities,G=this.getDsCapabilities(U,"update")&&K,Z=this.getDsCapabilities(U,"delete")&&K,_=F===i.Custom,$=_?y&&Z:Z,V={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:h.TreeItemActionType.RenderOverrideItem,children:[{name:h.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:h.TreeItemActionType.RenderOverrideItemContent,children:[{name:h.TreeItemActionType.RenderOverrideItemBody,children:[{name:h.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:h.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:h.TreeItemActionType.RenderOverrideItemDragHandle},{name:h.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:h.TreeItemActionType.RenderOverrideItemIcon},{name:h.TreeItemActionType.RenderOverrideItemTitle},{name:h.TreeItemActionType.RenderOverrideItemCommands},{name:h.TreeItemActionType.RenderOverrideItemDetailToggle}]}]},{name:h.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]}]})};let q=0;null==Q||Q.forEach((e=>{(null==e?void 0:e.editAuthority)&&q++}));const X=this.formatMessage("visible"),ee=this.formatMessage("invisible");return(0,l.jsx)("div",{className:"w-100 h-100",css:this.getStyle(u)},(0,l.jsx)("div",{className:"w-100 h-100 layer-config-panel"},(0,l.jsx)("div",{className:"setting-container"},(0,l.jsx)(n.SettingSection,{title:this.formatMessage("data"),className:"pt-0"},(0,l.jsx)(n.SettingRow,null,(0,l.jsx)(r.DataSourceSelector,{types:O?this.supportedDsTypes:this.partSupportedDsTypes,disableRemove:()=>!0,useDataSources:d?(0,l.Immutable)([d]):(0,l.Immutable)([]),mustUseDataSource:!0,onChange:z,closeDataSourceListOnChange:!0,hideDs:this.onFilterDs})),d&&this.checkIsDsAutoRefreshSettingOpen(R)&&(0,l.jsx)(n.SettingRow,{label:this.formatMessage("updateText")},(0,l.jsx)(o.Switch,{className:"can-x-switch",checked:k,onChange:e=>{g("updateText",e.target.checked)},"aria-label":this.formatMessage("updateText")}))),d&&(0,l.jsx)(c.Fragment,null,(0,l.jsx)(n.SettingSection,{title:this.formatMessage("label")},(0,l.jsx)(n.SettingRow,null,(0,l.jsx)(o.TextInput,{type:"text",size:"sm",className:"w-100",value:W,onChange:this.nameChange,onAcceptValue:this.nameAccept,"aria-label":this.formatMessage("label")}))),(0,l.jsx)(n.SettingSection,{title:this.formatMessage("configFields")},(0,l.jsx)(n.SettingRow,null,(0,l.jsx)(o.Select,{size:"sm",className:"w-100",value:F,onChange:e=>{this.handleHonorTypeChange(e.target.value)}},(0,l.jsx)("option",{value:i.Webmap},this.formatMessage("layerHonorSetting")),(0,l.jsx)("option",{value:i.Custom},this.formatMessage("layerCustomize")))),_&&(0,l.jsx)(c.Fragment,null,(0,l.jsx)(n.SettingRow,null,this.formatMessage("configTips")),(0,l.jsx)(n.SettingRow,null,(0,l.jsx)(r.FieldSelector,{useDataSources:d?(0,l.Immutable)([d]):(0,l.Immutable)([]),"aria-label":this.formatMessage("configTips"),onChange:this.onFieldChange,selectedFields:(0,l.Immutable)(E),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0})),(0,l.jsx)(n.SettingRow,{flow:"wrap",label:y&&this.formatMessage("editableCount",{count:q})},(0,l.jsx)("div",{className:"fields-list-header form-inline"},(0,l.jsx)("div",{className:"d-flex w-100 ml-1 fields-list-check"},y&&(0,l.jsx)(o.Checkbox,{id:"editAllField","data-field":"editAllField",onClick:()=>{this.handleListBoxAll(Y,B)},checked:!Y,title:Y?`${this.formatMessage("editable")} (${this.formatMessage("checkAll")})`:`${this.formatMessage("editable")} (${this.formatMessage("uncheckAll")})`}),(0,l.jsx)(o.Label,{for:"editAllField",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("field")},this.formatMessage("field"))))),(0,l.jsx)(n.SettingRow,{className:"selected-fields-con"},(0,l.jsx)(h.List,Object.assign({className:"selected-fields-list",itemsJson:Array.from(Q).map(((e,t)=>Object.assign(Object.assign({itemStateDetailContent:e},y?{itemStateChecked:null==e?void 0:e.editAuthority}:{}),{itemStateDisabled:!this.checkFieldsExist(J,e),itemKey:`${t}`,itemStateIcon:r.dataComponentsUtils.getIconFromFieldType(e.type,u),itemStateTitle:e.alias||e.jimuName||e.name,isCheckboxDisabled:!this.getFieldEditable(B,e.jimuName),itemStateCommands:[]}))),dndEnabled:!0,isMultiSelection:y,onUpdateItem:(e,t)=>{const{itemJsons:i,updateType:a}=e;if(y||a===h.TreeItemActionType.HandleDidDrop){const e=i[i.length-1].map((e=>Object.assign(Object.assign({},e.itemStateDetailContent),{editAuthority:e.itemStateChecked})));g("tableFields",e);const t=this.getUncheckState(e);this.setState({hasUncheck:t})}},renderOverrideItemDetailToggle:(e,t)=>{const{itemJsons:i,itemJsons:[{itemStateDetailContent:a}]}=t.props,[s]=i,{jimuName:n}=null==s?void 0:s.itemStateDetailContent,r=this.getCurrentEditField(n);return a?(0,l.jsx)(c.Fragment,null,(0,l.jsx)(o.Button,{icon:!0,type:"tertiary",title:r.visible?X:ee,"aria-label":r.visible?X:ee,className:"jimu-tree-item__detail-toggle",onClick:e=>{e.stopPropagation(),this.toggleFieldVisible(n)},onKeyUp:e=>{this.onKeyUp(e,n)},css:()=>l.css`
                                &.jimu-tree-item__detail-toggle {
                                  display: flex;
                                  align-items: center;
                                  cursor: pointer;

                                  .icon-btn-sizer {
                                    margin: 0;
                                    min-width: 0.5rem;
                                    min-height: 0.5rem;
                                  }
                                }
                              `},r.visible?(0,l.jsx)(b,null):(0,l.jsx)(v,null))):null}},V))),G&&(0,l.jsx)(n.SettingRow,null,(0,l.jsx)("div",{className:"d-flex w-100"},(0,l.jsx)(o.Checkbox,{id:"editable-cb","data-field":"enableEdit",onClick:this.handleCheckboxChange,checked:y}),(0,l.jsx)(o.Label,{for:"editable-cb",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("enableEdit")},this.formatMessage("enableEdit")))))),(0,l.jsx)(n.SettingSection,{role:"group",title:this.formatMessage("tableOptions"),"aria-label":this.formatMessage("tableOptions")},(0,l.jsx)(n.SettingRow,{label:(0,l.jsx)("strong",null,this.formatMessage("columnSize")),flow:"wrap",role:"group","aria-label":this.formatMessage("columnSize")},(0,l.jsx)("div",{className:"jimu-builder--background-setting"},(0,l.jsx)("div",{role:"radiogroup"},(0,l.jsx)(o.Label,{className:"d-flex align-items-center"},(0,l.jsx)(o.Radio,{style:{cursor:"pointer"},name:"responsiveType",className:"mr-2",checked:(null==A?void 0:A.responsiveType)===a.Fit,onChange:()=>{this.handleColumnStyleChange("responsiveType",a.Fit)}}),this.formatMessage("fitToData")),(0,l.jsx)(o.Label,{className:"d-flex align-items-center"},(0,l.jsx)(o.Radio,{style:{cursor:"pointer"},name:"displayOrderType",className:"mr-2",checked:(null==A?void 0:A.responsiveType)===a.Fixed,onChange:()=>{this.handleColumnStyleChange("responsiveType",a.Fixed)}}),this.formatMessage("fixed"))),(null==A?void 0:A.responsiveType)===a.Fixed&&(0,l.jsx)(n.SettingRow,{label:this.formatMessage("columnWidth")},(0,l.jsx)(C.InputUnit,{style:{width:"35%"},"aria-label":this.formatMessage("columnWidth"),min:80,max:8192,value:{distance:null!==(e=null==A?void 0:A.columnWidth)&&void 0!==e?e:80,unit:o.DistanceUnits.PIXEL},onChange:({distance:e})=>{this.handleColumnStyleChange("columnWidth",e)}})))),(0,l.jsx)(n.SettingRow,{label:(0,l.jsx)("strong",null,this.formatMessage("variableHeader")),flow:"wrap",role:"group","aria-label":this.formatMessage("variableHeader")},(0,l.jsx)("div",{className:"jimu-builder--background-setting"},(0,l.jsx)(n.SettingRow,{truncateLabel:!0,flow:"no-wrap",role:"group",label:this.formatMessage("font"),"aria-label":this.formatMessage("font"),className:"mt-2"},(0,l.jsx)(C.FontStyle,{"aria-label":this.formatMessage("fontStyle"),bold:null==P?void 0:P.bold,types:w,onChange:this.handleHeaderStyleChange}),(0,l.jsx)(T.ThemeColorPicker,{icon:j(),type:"with-icon",title:this.formatMessage("fontColor"),"aria-label":this.formatMessage("fontColor"),specificTheme:m,value:null==P?void 0:P.color,onChange:e=>{this.handleHeaderStyleChange("color",e)},className:"jimu-outline-inside"}),(0,l.jsx)(C.InputUnit,{style:{width:"35%"},"aria-label":this.formatMessage("fontSize"),min:12,max:99,value:{distance:null!==(s=null==P?void 0:P.fontSize)&&void 0!==s?s:14,unit:o.DistanceUnits.PIXEL},onChange:({distance:e})=>{this.handleHeaderStyleChange("fontSize",e)}})),(0,l.jsx)(n.SettingRow,{label:this.formatMessage("backgroundColor")},(0,l.jsx)(T.ThemeColorPicker,{text:!0,specificTheme:m,"aria-label":this.formatMessage("backgroundColor"),value:null==P?void 0:P.backgroundColor,onChange:e=>{this.handleHeaderStyleChange("backgroundColor",e)}}))))),(0,l.jsx)(n.SettingSection,{role:"group",className:"last-setting-section",title:this.formatMessage("tools"),"aria-label":this.formatMessage("tools")},(0,l.jsx)(n.SettingRow,{label:this.formatMessage("enableSearch")},(0,l.jsx)(o.Switch,{className:"can-x-switch",checked:M||!1,onChange:e=>{const t=e.target.checked;p.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:x,propKey:"optionChangeSuggestion",value:!0}),g("enableSearch",t)},"aria-label":this.formatMessage("enableSearch")})),M&&(0,l.jsx)(c.Fragment,null,(0,l.jsx)(n.SettingRow,{flow:"wrap",label:this.formatMessage("searchFields")},(0,l.jsx)("div",{className:"w-100 search-container",style:{zIndex:3}},(0,l.jsx)(r.FieldSelectorWithFullTextIndex,{useDataSources:d?(0,l.Immutable)([d]):(0,l.Immutable)([]),onChange:this.handleChooseSearchingFieldsChange,selectedFields:S?(0,l.Immutable)(S):(0,l.Immutable)([]),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,widgetId:H,types:(0,l.Immutable)([l.JimuFieldType.Number,l.JimuFieldType.String]),"aria-label":this.formatMessage("searchFields")}))),(0,l.jsx)(n.SettingRow,{className:"w-100 d-flex justify-content-between"},(0,l.jsx)(o.Label,null,(0,l.jsx)(o.Checkbox,{style:{cursor:"pointer"},checked:D,"aria-label":this.formatMessage("fullMatch"),onChange:this.changeMatchType}),(0,l.jsx)("div",{className:"m-0 ml-2 flex-grow-1 omit-label"},this.formatMessage("fullMatch")))),(0,l.jsx)(n.SettingRow,{flow:"wrap",label:this.formatMessage("searchHint")},(0,l.jsx)(o.TextInput,{size:"sm",className:"search-placeholder w-100",placeholder:this.formatMessage("search"),value:f||"",onChange:this.onSearchPlaceholderChange,"aria-label":this.formatMessage("searchHint")}))),["enableSelect","showCount","enableRefresh"].map(((e,i)=>(0,l.jsx)(c.Fragment,{key:i},(0,l.jsx)(n.SettingRow,{label:this.formatMessage(e)},(0,l.jsx)(o.Switch,{className:"can-x-switch",checked:this.props[e]||!1,onChange:t=>{g(e,t.target.checked)},"aria-label":this.formatMessage(e)})),"enableSelect"===e&&this.props[e]&&(0,l.jsx)(n.SettingRow,{flow:"wrap",label:this.formatMessage("selectMode"),className:"select-option"},(0,l.jsx)(o.Select,{size:"sm",value:this.props.selectMode||t.Multiple,onChange:e=>{g("selectMode",e.target.value)},"aria-label":this.formatMessage("selectMode")},this.getSelectModeOptions()))))),$&&(0,l.jsx)(n.SettingRow,{label:this.formatMessage("deleteRecords")},(0,l.jsx)(o.Switch,{className:"can-x-switch",checked:this.props.enableDelete||!1,onChange:e=>{g("enableDelete",e.target.checked)},"aria-label":this.formatMessage("deleteRecords")}))),(0,l.jsx)("div",{className:"ds-container"},(0,l.jsx)(l.DataSourceComponent,{useDataSource:(0,l.Immutable)(d),onDataSourceCreated:this.onDataSourceCreated,onDataSourceInfoChange:this.onDataSourceInfoChange}))))))}}class P extends l.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=()=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,l.jsx)(l.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var A=g(62838),k=g.n(A),H=g(31027),F=g.n(H),O=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const R=e=>{const t=window.SVG,{className:i}=e,a=O(e,["className"]),s=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?l.React.createElement(t,Object.assign({className:s,src:F()},a)):l.React.createElement("svg",Object.assign({className:s},a))},W=Object.assign({},d,o.defaultMessages);class Y extends l.React.PureComponent{constructor(e){super(e),this.partSupportedDsTypes=(0,l.Immutable)([l.AllDataSourceTypes.FeatureLayer,l.AllDataSourceTypes.SceneLayer,l.AllDataSourceTypes.BuildingComponentSubLayer,l.AllDataSourceTypes.OrientedImageryLayer,l.AllDataSourceTypes.ImageryLayer]),this.sidePopperTrigger=l.React.createRef(),this.updateDsHash=e=>{this.dsHash={};let t=0;e.forEach((e=>{const{useDataSource:i,tableFields:a}=e,s=a.map((e=>e.jimuName)),o=(0,l.Immutable)(i).set("fields",s);this.dsHash[t]=o,t++}))},this.getNewConfigId=e=>{var t;return`${e}-${((null===(t=this.props.config)||void 0===t?void 0:t.layersConfig.length)>0?this.getArrayMaxId(this.props.config.layersConfig):0)+1}`},this.flattenDataSources=e=>{const t=[],i=e=>{if(e.isDataSourceSet){e.getChildDataSources().forEach((e=>{i(e)}))}else t.push(e)};return i(e),t},this.constructConfig=e=>{var s,o,n;const r=e.getSchema(),d=null==e?void 0:e.getLayerDefinition(),c=["CreationDate","Creator","EditDate","Editor","GlobalID"],h=(null==r?void 0:r.fields)?Object.values(null==r?void 0:r.fields):[],g=(null==d?void 0:d.fields)||[];let u=h.filter((e=>!c.includes(e.jimuName))).map((e=>{const t=g.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,editable:i,visible:!0})}));const p=null===(s=null==e?void 0:e.getPopupInfo())||void 0===s?void 0:s.fieldInfos;if("output"!==e.dataViewId&&p&&(null==p?void 0:p.length)>0){const e=[];p.forEach((t=>{(null==t?void 0:t.visible)&&e.push(t.fieldName)})),u=u.filter((t=>e.includes(t.name)))}(null==u?void 0:u.length)>50&&(u=u.slice(0,50));const m={dataSourceId:e.id,mainDataSourceId:null===(o=e.getMainDataSource())||void 0===o?void 0:o.id,dataViewId:e.dataViewId,rootDataSourceId:null===(n=e.getRootDataSource())||void 0===n?void 0:n.id},I=(0,l.Immutable)(m),S=u.map((e=>e.jimuName)),b=I.set("fields",S);return{id:this.getNewConfigId(e.id),name:e.getLabel(),useDataSource:b.asMutable({deep:!0}),allFields:h,tableFields:u,enableAttachements:!1,enableEdit:!1,allowCsv:!1,enableSearch:!1,searchFields:[],enableRefresh:!0,enableSelect:!0,enableDelete:!1,selectMode:t.Single,headerFontSetting:{backgroundColor:"",fontSize:14,bold:!1,color:""},columnSetting:{responsiveType:a.Fixed,columnWidth:200},layerHonorMode:i.Webmap}},this.dataSourceChangeSave=e=>{if(!e)return;const t=(0,l.Immutable)(e[0]),i=this.dsManager.getDataSource(t.dataSourceId),a=this.flattenDataSources(i),{config:s}=this.props,{layersConfig:o}=s,n=o[this.index];let r=0;const d=[];a.forEach((e=>{var t;if(this.partSupportedDsTypes.includes(null==e?void 0:e.type)&&!(null===(t=null==e?void 0:e.dataSourceJson)||void 0===t?void 0:t.isHidden)){const t=this.constructConfig(e);d.push(t)}r++}));const c=a.length;if(r===c){let e;if(n&&1===c){const t=o.asMutable({deep:!0});t.splice(this.index,1,d[0]),e=(0,l.Immutable)(t)}else{e=o.concat(d)}this.updateDsHash(e.asMutable({deep:!0}));const t={id:this.props.id,config:this.props.config.set("layersConfig",e),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(t),this.setState({newAddFlag:!1})}},this.onCloseLayerPanel=()=>{this.setState({showLayerPanel:!1}),this.index=0},this.getUniqueValues=(e=[],t=[])=>{const i=e.concat(t).filter((function(e,t,i){return i.indexOf(e)===t}));return i},this.getUseDataSourcesByDsHash=()=>{const e={};Object.keys(this.dsHash).forEach((t=>{const i=this.dsHash[t].dataSourceId;let a;a=e[i]?(0,l.Immutable)({dataSourceId:this.dsHash[t].dataSourceId,mainDataSourceId:this.dsHash[t].mainDataSourceId,dataViewId:this.dsHash[t].dataViewId,rootDataSourceId:this.dsHash[t].rootDataSourceId,fields:this.getUniqueValues(e[i].fields,this.dsHash[t].fields)}):this.dsHash[t],e[i]=a}));const t=[];return Object.keys(e).forEach((i=>{t.push(e[i])})),t},this.removeLayer=e=>{this.index===e&&this.onCloseLayerPanel();const t=this.props.config.layersConfig.asMutable({deep:!0});t.splice(e,1);const i=this.props.config.set("layersConfig",t);delete this.dsHash[e],this.updateDsHash(t);const a={id:this.props.id,config:i,useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(a),this.index>e&&this.index--,p.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"removeLayerFlag",value:!0})},this.optionChangeSave=(e,t)=>{const i=this.props.config.layersConfig[this.index];if(i){const a=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},i),{[e]:t})),s={id:this.props.id,config:a};this.props.onSettingChange(s)}},this.multiOptionsChangeSave=e=>{const t=this.props.config.layersConfig[this.index];if(t){const i=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},t),e)),a={id:this.props.id,config:i};this.props.onSettingChange(a)}},this.dataSourceFieldsChange=(e,t)=>{const i=this.props.config.layersConfig.filter((t=>{var i;return(null==e?void 0:e.dataSourceId)===(null===(i=null==t?void 0:t.useDataSource)||void 0===i?void 0:i.dataSourceId)}));let a=[];i.forEach((e=>{const{id:i,tableFields:s}=e;if(i===(null==t?void 0:t.id))a=a.concat(null==t?void 0:t.usedFields);else{const e=s.map((e=>e.jimuName));a=a.concat(e)}}));const s=new Set(a),o=Array.from(s),{useDataSources:n}=this.props,r=n.findIndex((t=>t.dataSourceId===(null==e?void 0:e.dataSourceId))),d=n.asMutable({deep:!0}),c=(0,l.Immutable)(e).set("fields",o);d[r]=c.asMutable({deep:!0}),this.props.onSettingChange({id:this.props.id,useDataSources:d})},this.getStyle=e=>l.css`
      .widget-setting-table {
        .filter-item {
          display: flex;
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.25rem;
          line-height: 23px;
          cursor: pointer;
          background-color: ${e.sys.color.secondary.main};

          .filter-item-icon {
            width: 14px;
            margin-right: 0.5rem;
          }
          .filter-item-name {
            word-wrap: break-word;
          }
        }

        .filter-item-active {
          border-left: 2px solid ${e.sys.color.primary.main};
        }

        .arrange-style-container {
          .arrange_container {
            margin-top: 10px;
            display: flex;
            .jimu-btn {
              padding: 0;
              background: ${e.ref.palette.neutral[300]};
              &.active {
                border: 2px solid ${e.sys.color.primary.light};
              }
            }
          }
        }
        .empty-placeholder {
          display: flex;
          flex-flow: column;
          justify-content: center;
          height: calc(100% - 255px);
          overflow: hidden;
          .empty-placeholder-inner {
            padding: 0px 20px;
            flex-direction: column;
            align-items: center;
            display: flex;

            .empty-placeholder-text {
              color: ${e.ref.palette.neutral[1e3]};
              font-size: ${l.polished.rem(14)};
              margin-top: 16px;
              text-align: center;
            }
            .empty-placeholder-icon {
              color: ${e.ref.palette.neutral[800]};
            }
          }
        }

        .setting-ui-unit-tree, .setting-ui-unit-list {
          width: 100%;
          .tree-item {
            justify-content: space-between;
            align-items: center;
            font-size: ${l.polished.rem(13)};
            &.tree-item_level-1 {
            }
            .jimu-checkbox {
              margin-right: .5rem;
            }
          }
        }
        .setting-ui-unit-list-new {
          padding-top: ${l.polished.rem(8)};
        }
      }
    `,this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:W[e]},t),this.onShowLayerPanel=(e,t=!1,i)=>{const{showLayerPanel:a}=this.state;this.setSidePopperAnchor(e,t),this.setState({newAddFlag:t}),e===this.index?(a||this.setState({activeId:i}),this.setState({showLayerPanel:!a})):(this.setState({activeId:i,showLayerPanel:!0,refreshPanel:!this.state.refreshPanel}),this.index=e)},this.switchTableType=e=>{if(e!==this.props.config.arrangeType){const t={id:this.props.id,config:this.props.config.set("arrangeType",e)};this.props.onSettingChange(t)}},this.onItemUpdated=(e,t)=>{const{id:i,config:a}=this.props,s=e.map((e=>e.itemStateDetailContent)),l={id:i,config:a.set("layersConfig",s)};this.updateDsHash(s),this.props.onSettingChange(l)},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState((i=>{const a=Object.assign({},i.dataSources);return a[e]=t,{dataSources:a}}))},this.isDataSourceAccessible=e=>{var t;const i=(null===(t=this.props.useDataSources)||void 0===t?void 0:t.filter((t=>e===t.dataSourceId)).length)>0;return null!==this.state.dataSources[e]&&i},this.setSidePopperAnchor=(e,t=!1)=>{let i;i=t?this.sidePopperTrigger.current.getElementsByClassName("add-table-btn")[0]:this.sidePopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e],this.setState({popperFocusNode:i})},this.index=0,this.dsManager=l.DataSourceManager.getInstance(),this.updateDsHash(this.props.config.layersConfig?this.props.config.layersConfig:[]),this.state={activeId:e.activeTabId,showLayerPanel:!1,refreshPanel:!1,dataSources:{},popperFocusNode:null,newAddFlag:!1}}componentDidUpdate(e){var t;const{activeId:i,showLayerPanel:a}=this.state,{config:s,activeTabId:o}=this.props,n=a&&!l.urlUtils.getAppIdPageIdFromUrl().pageId;if(o!==e.activeTabId&&o!==i){this.setState({activeId:o});const e=null===(t=s.layersConfig)||void 0===t?void 0:t.findIndex((e=>e.id===o));if(e<0)return;n&&this.onShowLayerPanel(e)}}getArrayMaxId(e){const t=e.map((e=>e.id.split("-").reverse()[0]));return t.length>0?Math.max.apply(null,t):0}render(){var t,i;const{activeId:a,showLayerPanel:s,popperFocusNode:r,newAddFlag:d}=this.state,{theme:c,theme2:u,config:m,id:I}=this.props,S=this.formatMessage("newSheet"),b=m.layersConfig.length,D={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:h.TreeItemActionType.RenderOverrideItem,children:[{name:h.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:h.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:h.TreeItemActionType.RenderOverrideItemBody,children:[{name:h.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:h.TreeItemActionType.RenderOverrideItemDragHandle},{name:h.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:h.TreeItemActionType.RenderOverrideItemTitle},{name:h.TreeItemActionType.RenderOverrideItemDetailToggle},{name:h.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,l.jsx)("div",{css:this.getStyle(c),className:"h-100"},(0,l.jsx)("div",{className:"widget-setting-table h-100"},null===(t=this.props.useDataSources)||void 0===t?void 0:t.map(((e,t)=>(0,l.jsx)(P,{key:t,useDataSource:e,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed}))),(0,l.jsx)(n.SettingSection,{className:"p-0 m-0 "+(b>0?"":"border-0")},(0,l.jsx)("div",{ref:this.sidePopperTrigger},(0,l.jsx)(n.SettingSection,{className:"border-0"},(0,l.jsx)(n.SettingRow,null,(0,l.jsx)(o.Button,{className:"w-100 text-default add-table-btn",type:"primary",onClick:()=>{this.onShowLayerPanel(b,!0)},"aria-label":S,"aria-describedby":"table-blank-msg"},(0,l.jsx)("div",{className:"w-100 px-2 text-truncate"},S)))),(0,l.jsx)(n.SettingSection,{className:"pt-0 border-0"},(0,l.jsx)("div",{className:"setting-ui-unit-list"},!!b&&(0,l.jsx)(h.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:Array.from(m.layersConfig).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:s&&t===this.index,itemStateTitle:e.name,itemStateCommands:[{label:this.formatMessage("remove"),iconProps:()=>({icon:k(),size:12}),action:()=>{this.removeLayer(t)}}]}))),dndEnabled:!0,renderOverrideItemDetailToggle:(e,t)=>{var i,a;const{itemJsons:s}=t.props,[n]=s,r=null===(a=null===(i=null==n?void 0:n.itemStateDetailContent)||void 0===i?void 0:i.useDataSource)||void 0===a?void 0:a.dataSourceId;return this.isDataSourceAccessible(r)?"":(0,l.jsx)(o.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:this.formatMessage("dataSourceCreateError")})},onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[a,s]=i;this.onItemUpdated(s,+a.itemKey)},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props,s=i.itemStateDetailContent.id;this.onShowLayerPanel(+i.itemKey,!1,s),a!==s&&(p.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:I,propKey:"activeTabId",value:s}),p.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:I,propKey:"settingChangeTab",value:!0}))}},D)),b===this.index&&s&&(0,l.jsx)(h.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map(((e,t)=>({itemStateDetailContent:e,itemKey:`${this.index}`,itemStateChecked:!0,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},D)))))),0===b&&(0,l.jsx)("div",{className:"empty-placeholder w-100"},(0,l.jsx)("div",{className:"empty-placeholder-inner"},(0,l.jsx)("div",{className:"empty-placeholder-icon"},(0,l.jsx)(R,{size:48})),(0,l.jsx)("div",{className:"empty-placeholder-text",id:"table-blank-msg",dangerouslySetInnerHTML:{__html:this.formatMessage("tableBlankStatus",{SheetString:S})}}))),b>0&&(0,l.jsx)(n.SettingSection,{className:"arrange-style-container",title:this.formatMessage("sheetStyle"),role:"group","aria-label":this.formatMessage("sheetStyle")},(0,l.jsx)(n.SettingRow,{className:"arrange_container"},(0,l.jsx)(o.Tooltip,{title:this.formatMessage("tabs"),placement:"bottom"},(0,l.jsx)(o.Button,{onClick:()=>{this.switchTableType(e.Tabs)},icon:!0,size:"sm",type:"tertiary",active:m.arrangeType===e.Tabs,"aria-pressed":m.arrangeType===e.Tabs},(0,l.jsx)(o.Icon,{autoFlip:!0,width:109,height:70,icon:g(79226)}))),(0,l.jsx)(o.Tooltip,{title:this.formatMessage("dropdown"),placement:"bottom"},(0,l.jsx)(o.Button,{onClick:()=>{this.switchTableType(e.Dropdown)},className:"ml-2",icon:!0,size:"sm",type:"tertiary",active:m.arrangeType===e.Dropdown,"aria-pressed":m.arrangeType===e.Dropdown},(0,l.jsx)(o.Icon,{autoFlip:!0,width:109,height:70,icon:g(8377)}))))),(0,l.jsx)(n.SidePopper,{position:"right",title:this.formatMessage("layerConfig"),isOpen:s&&!l.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:this.onCloseLayerPanel,trigger:null===(i=this.sidePopperTrigger)||void 0===i?void 0:i.current,backToFocusNode:r},(0,l.jsx)(z,Object.assign({},m.layersConfig.asMutable({deep:!0})[this.index],{intl:this.props.intl,theme:c,appTheme:u,widgetId:I,newAddFlag:d,dataSourceChange:this.dataSourceChangeSave,optionChange:this.optionChangeSave,multiOptionsChange:this.multiOptionsChangeSave,onDataSourceFieldsChange:this.dataSourceFieldsChange,onClose:this.onCloseLayerPanel})))))}}Y.mapExtraStateProps=(e,t)=>{var i,a;return{dsJsons:e.appStateInBuilder.appConfig.dataSources,activeTabId:e&&(null===(a=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.widgetsState[t.id])||void 0===a?void 0:a.activeTabId)}};const B=Y;function L(e){g.p=e}})(),u})())}}}));