System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/utility-selector"],(function(e,t){var i={},o={},n={},r={};return{setters:[function(e){i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.React=e.React,i.SupportedUtilityType=e.SupportedUtilityType,i.UtilityManager=e.UtilityManager,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.jsx=e.jsx,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,i.lodash=e.lodash,i.polished=e.polished},function(e){o.Switch=e.Switch,o.defaultMessages=e.defaultMessages},function(e){n.MapWidgetSelector=e.MapWidgetSelector,n.SearchDataSetting=e.SearchDataSetting,n.SearchDataType=e.SearchDataType,n.SearchGeneralSetting=e.SearchGeneralSetting,n.SearchSuggestionSetting=e.SearchSuggestionSetting,n.SettingRow=e.SettingRow,n.SettingSection=e.SettingSection},function(e){r.UtilitySelector=e.UtilitySelector,r.addNewUtility=e.addNewUtility,r.extractService=e.extractService}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=o},79298:e=>{"use strict";e.exports=n},71371:e=>{"use strict";e.exports=r}},t={};function l(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,l),n.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var s={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(s),l.d(s,{__set_webpack_public_path__:()=>I,default:()=>j});var e=l(79244),t=l(14321),i=l(79298),o=l(71371),n=l(31027),r=l.n(n),a=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(i[o[n]]=e[o[n]])}return i};const u=t=>{const i=window.SVG,{className:o}=t,n=a(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",o);return i?e.React.createElement(i,Object.assign({className:l,src:r()},n)):e.React.createElement("svg",Object.assign({className:l},n))},c={routeSettings:"Route Settings",searchSettings:"Search settings",generalSettings:"General settings",routeUrl:"Route URL",outputStops:"Stops",outputRoute:"Route",outputDirectionPoints:"Direction points",outputDirectionLines:"Direction lines"};function d(e){return`${e}_output_stop`}function g(e){return`${e}_output_direction_point`}function p(e){return`${e}_output_direction_line`}function f(e){return`${e}_output_route`}function v(t){if(!t)return null;const i={};return t.forEach((t=>{i[t.name]=e.dataSourceUtils.convertFieldToJimuField(t,null)})),i}var S=function(e,t,i,o){return new(i||(i=Promise))((function(n,r){function l(e){try{a(o.next(e))}catch(e){r(e)}}function s(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,s)}a((o=o.apply(e,t||[])).next())}))};const{useMemo:y,useEffect:m,useState:h}=e.React,x={maxSuggestions:6},b=[e.SupportedUtilityType.Routing],j=n=>{var r,l,s,a;const{onSettingChange:j,id:I,config:C,useMapWidgetIds:O,useUtilities:D,portalUrl:T}=n,_=e.hooks.useTranslation(c,t.defaultMessages),M=null==C?void 0:C.routeConfig,R=null===(r=C.searchConfig)||void 0===r?void 0:r.dataConfig,N=null===(l=C.searchConfig)||void 0===l?void 0:l.generalConfig,P=y((()=>{var t;return(0,e.Immutable)(x).merge((null===(t=C.searchConfig)||void 0===t?void 0:t.suggestionConfig)||{})}),[null===(s=C.searchConfig)||void 0===s?void 0:s.suggestionConfig]),[F,G]=h(null),[A,E]=h(!1),W=y((()=>(null==O?void 0:O.length)>0),[O]),L=`${I}-desc`;return m((()=>{var t;const i=R&&function(e,t){return e.filter((e=>t.some((t=>t.utilityId===e.useUtility.utilityId))))}(R,D),o=M&&function(e,t){if(e&&e.useUtility&&t.some((t=>t.utilityId===e.useUtility.utilityId)))return e;return null}(M,D);e.lodash.isDeepEqual(i,R)&&e.lodash.isDeepEqual(o,M)||j({id:I,config:C.setIn(["searchConfig","dataConfig"],i).setIn(["routeConfig"],o),useUtilities:U(null==o?void 0:o.useUtility,null===(t=null==i?void 0:i.map((e=>e.useUtility)))||void 0===t?void 0:t.asMutable())})}),[C,I,j,M,R,D]),m((()=>{if(F)return;const t=function(t){var i;const n=null===(i=(0,e.getAppStore)().getState().portalSelf)||void 0===i?void 0:i.helperServices;return(0,o.extractService)(n,e.SupportedUtilityType.Routing,null,null,t)}(_),i=t[0];(0,o.addNewUtility)(i);const n=e.UtilityManager.getInstance().getIdOfOrgUtility(i.name,i.url,i.index,i.label);!F&&n&&G(n)}),[F,_]),m((()=>{var e,t,i;if(F&&!(null==C?void 0:C.routeConfig)&&!A){const o={utilityId:F};j({id:I,config:C.setIn(["routeConfig","useUtility"],o),useUtilities:U(o,null===(i=null===(t=null===(e=C.searchConfig)||void 0===e?void 0:e.dataConfig)||void 0===t?void 0:t.map((e=>e.useUtility)))||void 0===i?void 0:i.asMutable())}),E(!0)}}),[C,A,F,I,j,_]),(0,e.jsx)("div",{className:"widget-setting-directions jimu-widget-setting",css:w},(0,e.jsx)(i.SettingSection,{title:_("selectMapWidget"),className:(0,e.classNames)({"border-0":!W})},(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(i.MapWidgetSelector,{onSelect:t=>S(void 0,void 0,void 0,(function*(){const i=yield function(t,i,o){return S(this,void 0,void 0,(function*(){var n,r,l,s;if(!i||0===i.length)return Promise.resolve([]);try{const[i,a,u,c]=yield(0,e.loadArcGISJSAPIModules)(["esri/rest/support/Stop","esri/rest/support/DirectionPoint","esri/rest/support/DirectionLine","esri/rest/support/RouteInfo"]);return[{id:d(t),label:o("outputStops"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPoint",schema:{idField:(null===(n=i.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===n?void 0:n.name)||"__OBJECTID",fields:Object.assign({},v(i.fields))}},{id:g(t),label:o("outputDirectionPoints"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPoint",schema:{idField:(null===(r=a.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===r?void 0:r.name)||"__OBJECTID",fields:Object.assign({},v(a.fields))}},{id:p(t),label:o("outputDirectionLines"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPolyline",schema:{idField:(null===(l=u.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===l?void 0:l.name)||"__OBJECTID",fields:Object.assign({},v(u.fields))}},{id:f(t),label:o("outputRoute"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPolyline",schema:{idField:(null===(s=c.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===s?void 0:s.name)||"__OBJECTID",fields:Object.assign({},v(c.fields))}}]}catch(e){return console.warn("Failed to create output data source in directions widget. ",e),Promise.resolve([])}}))}(I,t,_);j({id:I,useMapWidgetIds:t},i)})),useMapWidgetIds:O}))),W?(0,e.jsx)("div",null,(0,e.jsx)(i.SettingSection,{role:"group","aria-label":_("routeSettings"),title:_("routeSettings")},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:_("routeUrl")},(0,e.jsx)(o.UtilitySelector,{useUtilities:(0,e.Immutable)((null==M?void 0:M.useUtility)&&(null==D?void 0:D.some((e=>M.useUtility.utilityId===e.utilityId)))?[M.useUtility]:[]),onChange:e=>{var t,i,o,n,r;(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.utilityId)!==(null===(i=null==M?void 0:M.useUtility)||void 0===i?void 0:i.utilityId)&&j({id:I,config:C.setIn(["routeConfig","useUtility"],null==e?void 0:e[0]),useUtilities:U(null==e?void 0:e[0],null===(r=null===(n=null===(o=C.searchConfig)||void 0===o?void 0:o.dataConfig)||void 0===n?void 0:n.map((e=>e.useUtility)))||void 0===r?void 0:r.asMutable())})},showRemove:!0,closePopupOnSelect:!0,types:b,"aria-describedby":L})),(0,e.jsx)(i.SettingRow,{className:"mt-0"},(0,e.jsx)("i",{className:"text-break example-url",id:L},_("exampleUrl",{url:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World"})))),(0,e.jsx)(i.SettingSection,{role:"group","aria-label":_("searchSettings"),title:_("searchSettings"),className:"search-settings"},(0,e.jsx)(i.SearchDataSetting,{id:I,datasourceConfig:R,createOutputDs:!1,portalUrl:T,hideIconSetting:!0,searchDataSettingType:i.SearchDataType.GeocodeService,onSettingChange:t=>{var i;e.lodash.isDeepEqual(t,R)||j({id:I,config:C.setIn(["searchConfig","dataConfig"],t),useUtilities:U(null==M?void 0:M.useUtility,null===(i=null==t?void 0:t.map((e=>e.useUtility)))||void 0===i?void 0:i.asMutable())})},autoSelectAllOrgGeocodeService:!0}),(0,e.jsx)(i.SearchGeneralSetting,{id:I,hint:null==N?void 0:N.hint,onSettingChange:e=>{"string"==typeof e&&e!==(null==N?void 0:N.hint)&&j({id:I,config:C.setIn(["searchConfig","generalConfig"],{hint:e})})}}),(0,e.jsx)(i.SearchSuggestionSetting,{id:I,settingConfig:P,onSettingChange:t=>{e.lodash.isDeepEqual(t,P)||j({id:I,config:C.setIn(["searchConfig","suggestionConfig"],t)})},hideRecentSearchSetting:!0})),(0,e.jsx)(i.SettingSection,{role:"group","aria-label":_("generalSettings"),title:_("generalSettings"),className:"general-settings"},(0,e.jsx)(i.SettingRow,{label:_("showRuntimeLayers")},(0,e.jsx)(t.Switch,{checked:null===(a=null==C?void 0:C.showRuntimeLayers)||void 0===a||a,onChange:e=>{const t=e.target.checked;j({id:I,config:C.set("showRuntimeLayers",t)})}})))):(0,e.jsx)("div",{className:"d-flex justify-content-center align-items-center placeholder-container"},(0,e.jsx)("div",{className:"text-center"},(0,e.jsx)(u,{size:48,className:"d-inline-block placeholder-icon mb-2"}),(0,e.jsx)("p",{className:"placeholder-hint"},_("selectMapHint")))))},w=e.css`
.route-url-input{
  min-height: ${e.polished.rem(100)}
}
.example-url{
  font-size: ${e.polished.rem(12)};
  color: var(--ref-palette-neutral-1000);
}
.warning-icon{
  color: var(--sys-color-error-main);
}
.warning-hint{
  width: calc(100% - 20px);
  margin: 0 4px;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--sys-color-error-main);
}
.placeholder-container{
  height: calc(100% - 100px);
  .placeholder-hint{
    font-size: ${e.polished.rem(14)};
    font-weight: 500;
    color: var(--ref-palette-neutral-1000);
    max-width: ${e.polished.rem(160)};
  }
  .placeholder-icon{
    color: var(--ref-palette-neutral-800);
  }
}
.search-settings{
  >div>div {
    padding-left: 0 !important;
    padding-right: 0 !important;
    padding-top: 0 !important;
    border: 0 !important;
  }
}
`;function U(e,t){return[e].concat(t).filter((e=>!!e))}function I(e){l.p=e}})(),s})())}}}));